import{aB as ae,_ as le,p as ce,f as h,g as S,h as ie,w as de,c,o as i,d as e,e as l,t as s,ai as p,a as $,b as y,B as E,aG as Z,$ as ue,ab as he,j as pe,a0 as ee,a9 as te,a6 as se,v as _e}from"./appInit-CGHXFw0-.js";import{L as ve}from"./LoadingSpinner-C-1wdek1.js";import{I as me}from"./IconAlertTriangle-BKoak6h-.js";import{I as fe}from"./IconArrowLeft-6FkQlYes.js";import{I as ge}from"./IconArrowRight-CAdyv1A0.js";import{I as ye}from"./IconChevronLeft-7fcgP1Nb.js";import{I as be}from"./IconChevronRight-BRihd1y4.js";import{I as oe}from"./IconEye-CnVKG0J1.js";import{I as N}from"./IconX-CVTrmr_B.js";import{g as we}from"./shop-Cvi7wzfy.js";import"./index-sC8Xq0xY.js";function Ce(){return ae({url:"/user/order/fetch",method:"get"}).then(m=>{if(typeof m=="object")return m;throw new Error("Invalid response format")}).catch(m=>{throw console.error("Error fetching order list:",m),m})}function ke(m){return new Promise((o,b)=>{if(!m){b(new Error("Trade number cannot be empty"));return}ae({url:"/user/order/cancel",method:"post",data:{trade_no:m}}).then(u=>{u&&typeof u=="object"?o(u):b(new Error("Invalid response format"))}).catch(u=>{console.error("Failed to cancel order:",u);let d="Failed to cancel order";if(u){if(typeof u.message=="string")d=u.message;else if(u.response&&u.response.data){const v=u.response.data;typeof v=="string"?d=v:v.message?d=v.message:v.error&&(d=v.error)}}b(new Error(d))})})}const Te={class:"orders-container"},Ie={class:"orders-inner"},Se={class:"dashboard-card welcome-card"},$e={class:"card-header"},Me={class:"card-title"},Ae={class:"card-body"},Oe={key:0,class:"orders-loading"},ze={key:1,class:"orders-error"},De={key:2,class:"orders-content"},Le={key:0,class:"pagination-container"},Ee={class:"pagination"},Ne=["disabled"],Fe={class:"page-info"},Pe=["disabled"],xe={key:0,class:"swipe-hint"},Ve={class:"order-card-header"},Be={class:"order-number"},Re={class:"label"},Xe={class:"value"},qe={class:"status-wrapper"},je={class:"order-card-body"},Ge={class:"info-row"},He={class:"label"},Ue={class:"value"},Qe={class:"info-row"},We={class:"label"},Ye={class:"value"},Je={class:"info-row"},Ke={class:"label"},Ze={class:"value amount"},et={class:"order-card-footer"},tt=["onClick"],st=["onClick","disabled"],ot={class:"order-table"},at={width:"22%"},nt={width:"16%"},rt={width:"10%"},lt={width:"14%"},ct={width:"14%"},it={width:"24%"},dt={class:"trade-no"},ut={class:"amount"},ht={class:"actions"},pt=["onClick"],_t=["onClick","disabled"],vt={key:3,class:"orders-empty"},mt={class:"modal-header"},ft={class:"modal-body"},gt={class:"trade-no-info"},yt={class:"trade-no"},bt={class:"modal-footer"},wt=["disabled"],Ct={key:0,class:"loader"},M=10,kt=50,Tt={__name:"OrderList",setup(m){const{t:o,locale:b}=ce(),u=pe(),d=he("$toast"),v=h(!0),w=h(""),f=h([]),A=h(!1),I=h(""),C=h(!1),F=h(!1),g=h("left"),P=h("à§³"),x=()=>{F.value=window.innerWidth<768};window.addEventListener("resize",x);const _=h(1),k=S(()=>Math.ceil(f.value.length/M)),V=S(()=>{const t=(_.value-1)*M,r=t+M;return f.value.slice(t,r)}),O=h(0),z=h(0),B=t=>{O.value=t.touches[0].clientX},R=t=>{z.value=t.touches[0].clientX},X=()=>{const t=z.value-O.value;Math.abs(t)>kt&&(t>0?(g.value="right",j()):(g.value="left",q())),O.value=0,z.value=0},q=()=>{_.value<k.value&&(g.value="left",_.value++)},j=()=>{_.value>1&&(g.value="right",_.value--)},D=async()=>{v.value=!0,w.value="";try{const t=await Ce();t&&t.data?(f.value=t.data,_.value=1):f.value=[]}catch(t){console.error("Failed to fetch orders:",t),w.value=t&&t.message?t.message:o("common.networkError")||"Network error",d&&d.error(w.value)}finally{v.value=!1}},G=t=>t?new Date(t*1e3).toLocaleString("en-US",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"--",H=t=>t?{month_price:o("shop.plan.price_options.month")||"Monthly",quarter_price:o("shop.plan.price_options.quarter")||"Quarterly",half_year_price:o("shop.plan.price_options.half_year")||"Half-year",year_price:o("shop.plan.price_options.year")||"Yearly",two_year_price:o("shop.plan.price_options.two_year")||"Two-year",three_year_price:o("shop.plan.price_options.three_year")||"Three-year",onetime_price:o("shop.plan.price_options.onetime")||"One-time",reset_price:o("shop.plan.price_options.reset_price")||"Reset package",deposit:o("shop.plan.price_options.deposit")||"Deposit"}[t]||t:"--",U=t=>t==null?"--":P.value+(t/100).toFixed(2),Q=S(()=>({0:o("orders.status.pending","Pending"),1:o("orders.status.processing","Processing"),2:o("orders.status.cancelled","Cancelled"),3:o("orders.status.completed","Completed"),4:o("orders.status.discounted","Discounted"),unknown:o("orders.status.unknown","Unknown status")})),W=t=>Q.value[t]||`${Q.value.unknown} (${t})`,Y=t=>({0:"status-pending",1:"status-processing",2:"status-cancelled",3:"status-completed",4:"status-discounted"})[t]||"status-unknown",J=t=>{u.push({path:"/payment",query:{trade_no:t,from:"orders"}})},K=t=>{I.value=t,A.value=!0},T=()=>{A.value=!1},ne=async()=>{if(!(!I.value||C.value)){C.value=!0;try{await ke(I.value),d&&typeof d.success=="function"&&d.success(o("orders.cancelSuccess")||"Order cancelled"),T(),D()}catch(t){console.error("Failed to cancel order, error object:",t);let r=o("orders.cancelFailed")||"Failed to cancel order";try{t&&(typeof t=="string"?r=t:t instanceof Error?r=t.message||r:typeof t.message=="string"&&(r=t.message))}catch(a){console.error("Error occurred while handling cancellation error:",a)}d&&typeof d.error=="function"?d.error(r):alert(r),T()}finally{C.value=!1}}},n=S(()=>({tradeNo:o("orders.tradeNo","Order No."),createdAt:o("orders.createdAt","Created At"),cycle:o("orders.cycle","Cycle"),totalAmount:o("orders.totalAmount","Amount"),statusLabel:o("orders.statusLabel","Status")||"Status",actions:o("orders.actions","Actions"),viewDetail:o("orders.viewDetail","View Details"),cancel:o("orders.cancel","Cancel Order"),noOrders:o("orders.noOrders","No orders yet"),goShopping:o("orders.goShopping","Go to Shop"),loading:o("orders.loading","Loading orders..."),cancelConfirmTitle:o("orders.cancelConfirmTitle","Cancel this order?"),cancelConfirmText:o("orders.cancelConfirmText","Are you sure you want to cancel this order? This cannot be undone.")})),re=async()=>{try{const t=await we();t&&t.data&&t.data.currency_symbol&&(P.value=t.data.currency_symbol)}catch(t){console.error("Failed to get currency symbol:",t)}};return ie(()=>{re(),D(),x()}),de(b,()=>{f.value.length>0&&(f.value=[...f.value])}),(t,r)=>(i(),c("div",Te,[e("div",Ie,[e("div",Se,[e("div",$e,[e("h2",Me,s(t.$t("orders.welcome.title")||"Order List"),1)]),e("div",Ae,[e("p",null,s(t.$t("orders.welcome.description")||"View and manage your orders"),1)])]),v.value?(i(),c("div",Oe,[l(ve),e("p",null,s(n.value.loading),1)])):w.value?(i(),c("div",ze,[l(p(me),{size:48,class:"error-icon"}),e("p",null,s(w.value),1),e("button",{class:"retry-button",onClick:D},s(t.$t("common.retry")||"Retry"),1)])):f.value.length>0?(i(),c("div",De,[k.value>1?(i(),c("div",Le,[e("div",Ee,[e("button",{class:y(["page-button prev",{disabled:_.value===1}]),onClick:j,disabled:_.value===1},[l(p(ye),{size:16})],10,Ne),e("div",Fe,s(t.$t("common.page")||"Page")+" "+s(_.value)+" / "+s(k.value),1),e("button",{class:y(["page-button next",{disabled:_.value===k.value}]),onClick:q,disabled:_.value===k.value},[l(p(be),{size:16})],10,Pe)])])):$("",!0),F.value?(i(),c("div",{key:1,class:"order-cards",onTouchstart:B,onTouchmove:R,onTouchend:X},[f.value.length>M?(i(),c("div",xe,[l(p(fe),{size:16,class:"swipe-icon"}),e("span",null,s(t.$t("common.swipeHint")||"Swipe left or right to switch"),1),l(p(ge),{size:16,class:"swipe-icon"})])):$("",!0),l(Z,{name:g.value==="right"?"page-switch-right":"page-switch"},{default:E(()=>[(i(!0),c(ee,null,te(V.value,a=>(i(),c("div",{key:a.trade_no,class:"order-card"},[e("div",Ve,[e("div",Be,[e("span",Re,s(n.value.tradeNo)+":",1),e("span",Xe,s(a.trade_no),1)]),e("div",qe,[e("span",{class:y(["status-badge",Y(a.status)])},s(W(a.status)),3)])]),e("div",je,[e("div",Ge,[e("span",He,s(n.value.createdAt)+":",1),e("span",Ue,s(G(a.created_at)),1)]),e("div",Qe,[e("span",We,s(n.value.cycle)+":",1),e("span",Ye,s(H(a.period)),1)]),e("div",Je,[e("span",Ke,s(n.value.totalAmount)+":",1),e("span",Ze,s(U(a.total_amount)),1)])]),e("div",et,[e("button",{class:"action-button view-button",onClick:L=>J(a.trade_no)},[l(p(oe),{size:16}),e("span",null,s(n.value.viewDetail),1)],8,tt),e("button",{class:y(["action-button cancel-button",{disabled:a.status!==0}]),onClick:L=>K(a.trade_no),disabled:a.status!==0},[l(p(N),{size:16}),e("span",null,s(n.value.cancel),1)],10,st)])]))),128))]),_:1},8,["name"])],32)):(i(),c("div",{key:2,class:"order-table-container",onTouchstart:B,onTouchmove:R,onTouchend:X},[e("table",ot,[e("thead",null,[e("tr",null,[e("th",at,s(n.value.tradeNo),1),e("th",nt,s(n.value.createdAt),1),e("th",rt,s(n.value.cycle),1),e("th",lt,s(n.value.totalAmount),1),e("th",ct,s(n.value.statusLabel),1),e("th",it,s(n.value.actions),1)])]),e("tbody",null,[l(Z,{name:g.value==="right"?"page-switch-right":"page-switch"},{default:E(()=>[(i(!0),c(ee,null,te(V.value,a=>(i(),c("tr",{key:a.trade_no},[e("td",dt,s(a.trade_no),1),e("td",null,s(G(a.created_at)),1),e("td",null,s(H(a.period)),1),e("td",ut,s(U(a.total_amount)),1),e("td",null,[e("span",{class:y(["status-badge",Y(a.status)])},s(W(a.status)),3)]),e("td",ht,[e("button",{class:"action-button view-button",onClick:L=>J(a.trade_no)},[l(p(oe),{size:16}),e("span",null,s(n.value.viewDetail),1)],8,pt),e("button",{class:y(["action-button cancel-button",{disabled:a.status!==0}]),onClick:L=>K(a.trade_no),disabled:a.status!==0},[l(p(N),{size:16}),e("span",null,s(n.value.cancel),1)],10,_t)])]))),128))]),_:1},8,["name"])])])],32))])):(i(),c("div",vt,[l(p(se),{size:48,class:"empty-icon"}),e("p",null,s(n.value.noOrders),1),e("button",{class:"shop-button",onClick:r[0]||(r[0]=a=>t.$router.push("/shop"))},[l(p(se),{size:16}),e("span",null,s(n.value.goShopping),1)])])),l(ue,{name:"modal-fade"},{default:E(()=>[A.value?(i(),c("div",{key:0,class:"modal-overlay",onClick:T},[e("div",{class:"modal-content",onClick:r[1]||(r[1]=_e(()=>{},["stop"]))},[e("div",mt,[e("h3",null,s(n.value.cancelConfirmTitle),1),e("button",{class:"modal-close",onClick:T},[l(p(N),{size:20})])]),e("div",ft,[e("p",null,s(n.value.cancelConfirmText),1),e("div",gt,[e("span",null,s(n.value.tradeNo)+":",1),e("span",yt,s(I.value),1)])]),e("div",bt,[e("button",{class:"btn-cancel",onClick:T},s(t.$t("common.cancel")||"Cancel"),1),e("button",{class:"btn-confirm",onClick:ne,disabled:C.value},[C.value?(i(),c("span",Ct)):$("",!0),e("span",null,s(t.$t("common.confirm")||"Confirm"),1)],8,wt)])])])):$("",!0)]),_:1})])]))}},Ft=le(Tt,[["__scopeId","data-v-cc12b99e"]]);export{Ft as default};
