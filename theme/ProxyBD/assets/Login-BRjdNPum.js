import{_ as W,I as J,L as j,k as x,c as i,o as r,d as e,a as v,e as u,n as Q,b as A,t as n,r as c,v as Y,l as k,x as M,y as K,A as X,z as G,P as Z,B as O,p as $,f as m,C as E,E as y,g as f,U as b,h as oo,G as eo,H as so,j as to,S as ao,Q as no}from"./appInit-CGHXFw0-.js";import{A as lo,I as ro,a as io,b as co,c as uo,s as go,v as R,d as ho}from"./authPopupState-BwxecuRU.js";import{h as mo,a as po}from"./tokenLogin-CcYAv57R.js";import"./index-sC8Xq0xY.js";import"./IconMail-DCQdTgWz.js";import"./IconArrowRight-CAdyv1A0.js";import"./IconEye-CnVKG0J1.js";import"./IconX-CVTrmr_B.js";const fo={name:"LoginView",components:{ThemeToggle:x,LanguageSelector:j,IconMail:uo,IconLock:J,IconArrowRight:co,IconEye:io,IconEyeOff:ro,AuthPopup:lo},setup(){const a=to(),{t:s}=$(),{showToast:w}=eo(),o=m("./images/logo.png"),N=()=>{o.value="/images/logo.png"},p=E({email:"",password:"",rememberMe:!1}),d=E({email:"",password:""}),g=m(!1),L=m(!1),I=m(!1),S=m(!1),_=m(!1),C=E({title:y.popup?.title||"",content:y.popup?.content||"",cooldownHours:y.popup?.cooldownHours||24,closeWaitSeconds:y.popup?.closeWaitSeconds||0}),P=()=>{_.value=!1},T=m(!1),l=f(()=>b?.splitLayout?.leftContent?.siteName?.show!==!1),U=f(()=>(b?.splitLayout?.leftContent?.siteName?.color||"white").toLowerCase()==="black"?"black":"white"),V=f(()=>{const t=b?.splitLayout?.leftContent?.backgroundImage||"";return t?{"background-image":`url(${t})`,"background-position":"center","background-size":"cover","background-repeat":"no-repeat"}:{background:"var(--theme-color)"}}),q=f(()=>b?.splitLayout?.leftContent?.greeting?.show!==!1),H=f(()=>D()),B=f(()=>(b?.splitLayout?.leftContent?.greeting?.color||"white").toLowerCase()==="black"?"black":"white");oo(async()=>{if(mo()){g.value=!0;try{if((await po({onLoginSuccess:()=>{console.log("Token verification login successful")}})).success)return}catch(h){console.error("Error during token login:",h)}finally{g.value=!1}}if(new URLSearchParams(window.location.search).get("logout")==="true"){if(console.log("Detected recent logout, clearing login state"),w(s("auth.logoutSuccess"),"success",3e3),window.history&&window.history.replaceState){const h=window.location.href.replace("?logout=true","").replace("&logout=true","");window.history.replaceState({},document.title,h)}return}try{if(window._isLoggingOut===!0){console.log("Detected global logout flag, skipping login status check");return}so()&&(console.log("User already logged in, redirecting to dashboard"),w(s("auth.alreadyLoggedIn"),"info"),setTimeout(()=>{a.push("/dashboard")},500)),_.value=go(y.popup)}catch(h){console.error("Login status check failed",h)}});const F=()=>{let t=!0;return d.email="",d.password="",R(p.email)?ho(p.email)||(d.email=s("validation.emailInvalid"),t=!1):(d.email=s("validation.emailRequired"),t=!1),R(p.password)||(d.password=s("validation.passwordRequired"),t=!1),t},z=async()=>{if(F()){g.value=!0;try{const t=await no(p);w(t.message||s("auth.loginSuccess"),"success",3e3),setTimeout(()=>{a.push("/dashboard")},300)}catch(t){w(t.response?.message||t.message||s("auth.loginFailed"),"error")}finally{g.value=!1}}},D=()=>{const t=new Date().getHours();return t>=5&&t<12?"Good Morning":t>=12&&t<18?"Good Afternoon":t>=18&&t<22?"Good Evening":"Good Night"};return{formData:p,errors:d,loading:g,showPassword:T,handleLogin:z,logoPath:o,handleLogoError:N,leftSideStyles:V,configLoading:L,showCaptchaModal:I,isClosingModal:S,showSiteName:l,siteNameColorClass:U,SITE_CONFIG:ao,showGreeting:q,greetingMessage:H,greetingColorClass:B,getTimeBasedGreeting:D,showAuthPopup:_,authPopupConfig:C,handleAuthPopupClose:P}}},wo={class:"login-view-container"},_o={class:"auth-split-container"},vo={class:"auth-split-right"},ko={class:"top-toolbar"},yo={key:0,class:"auth-form-container"},bo={class:"loading-container"},Co={key:1,class:"auth-form-container"},Lo={class:"auth-header"},Io={class:"auth-logo"},So=["src"],Po={class:"auth-title"},To={class:"auth-subtitle"},Ao={class:"form-group"},Mo={for:"email"},Eo={class:"input-with-icon"},No=["placeholder"],Do={key:0,class:"error-message"},Go={class:"form-group"},Oo={for:"password"},Ro={class:"input-with-icon"},Uo=["type","placeholder"],Vo={key:0,class:"error-message"},qo={class:"form-options"},Ho={class:"remember-me"},Bo={class:"checkbox-container"},Fo={class:"checkbox-label"},zo=["disabled"],Wo={key:0,class:"loading-wrapper"},Jo={key:1},jo={class:"auth-footer"},xo={class:"auth-divider"},Qo={class:"auth-divider-text"};function Yo(a,s,w,o,N,p){const d=c("ThemeToggle"),g=c("LanguageSelector"),L=c("IconMail"),I=c("IconLock"),S=c("IconEye"),_=c("IconEyeOff"),C=c("router-link"),P=c("IconArrowRight"),T=c("AuthPopup");return r(),i("div",wo,[e("div",_o,[e("div",{class:"auth-split-left",style:Q(o.leftSideStyles)},[s[6]||(s[6]=e("div",{class:"left-content-overlay"},null,-1)),o.showSiteName?(r(),i("div",{key:0,class:A(["site-name",o.siteNameColorClass])},n(o.SITE_CONFIG.siteName),3)):v("",!0),o.showGreeting?(r(),i("div",{key:1,class:A(["greeting-text",o.greetingColorClass])},n(o.greetingMessage),3)):v("",!0)],4),e("div",vo,[e("div",ko,[u(d),u(g)]),o.configLoading?(r(),i("div",yo,[e("div",bo,[s[7]||(s[7]=e("div",{class:"loading-spinner"},null,-1)),e("p",null,n(a.$t("common.loading")),1)])])):(r(),i("div",Co,[e("div",Lo,[e("div",Io,[e("img",{src:o.logoPath,alt:"Logo",onError:s[0]||(s[0]=(...l)=>o.handleLogoError&&o.handleLogoError(...l))},null,40,So)]),e("h1",Po,n(a.$t("auth.loginTitle")),1),e("p",To,n(a.$t("auth.loginSubtitle")),1)]),e("form",{class:"auth-form",onSubmit:s[5]||(s[5]=Y((...l)=>o.handleLogin&&o.handleLogin(...l),["prevent"]))},[e("div",Ao,[e("label",Mo,[k(n(a.$t("common.email"))+" ",1),s[8]||(s[8]=e("span",{class:"required"},"*",-1))]),e("div",Eo,[u(L,{class:"input-icon"}),M(e("input",{type:"email",id:"email","onUpdate:modelValue":s[1]||(s[1]=l=>o.formData.email=l),class:"form-control",placeholder:a.$t("auth.emailPlaceholder"),required:""},null,8,No),[[K,o.formData.email]])]),o.errors.email?(r(),i("div",Do,n(o.errors.email),1)):v("",!0)]),e("div",Go,[e("label",Oo,[k(n(a.$t("common.password"))+" ",1),s[9]||(s[9]=e("span",{class:"required"},"*",-1))]),e("div",Ro,[u(I,{class:"input-icon"}),M(e("input",{type:o.showPassword?"text":"password",id:"password","onUpdate:modelValue":s[2]||(s[2]=l=>o.formData.password=l),class:"form-control",placeholder:a.$t("auth.passwordPlaceholder"),required:""},null,8,Uo),[[X,o.formData.password]]),e("div",{class:"password-toggle",onClick:s[3]||(s[3]=l=>o.showPassword=!o.showPassword)},[o.showPassword?(r(),G(_,{key:1})):(r(),G(S,{key:0}))])]),o.errors.password?(r(),i("div",Vo,n(o.errors.password),1)):v("",!0)]),e("div",qo,[e("div",Ho,[e("label",Bo,[M(e("input",{type:"checkbox","onUpdate:modelValue":s[4]||(s[4]=l=>o.formData.rememberMe=l)},null,512),[[Z,o.formData.rememberMe]]),s[10]||(s[10]=e("span",{class:"checkmark"},null,-1)),e("span",Fo,n(a.$t("common.rememberMe")),1)])]),u(C,{to:"/forgot-password",class:"forgot-password"},{default:O(()=>[k(n(a.$t("common.forgotPassword")),1)]),_:1})]),e("button",{type:"submit",class:"btn btn-primary btn-block",disabled:o.loading},[o.loading?(r(),i("span",Wo,[e("span",null,n(a.$t("common.loading")),1)])):(r(),i("span",Jo,[k(n(a.$t("common.login"))+" ",1),u(P,{class:"icon-right"})]))],8,zo)],32),e("div",jo,[e("div",xo,[e("span",Qo,n(a.$t("auth.noAccount")),1)]),u(C,{to:"/register",class:"btn btn-secondary btn-block",replace:""},{default:O(()=>[k(n(a.$t("auth.createAccount")),1)]),_:1})])]))])]),o.showCaptchaModal?(r(),i("div",{key:0,class:A(["captcha-modal",{closing:o.isClosingModal}])},null,2)):v("",!0),u(T,{"show-popup":o.showAuthPopup,title:o.authPopupConfig.title,content:o.authPopupConfig.content,"cooldown-hours":o.authPopupConfig.cooldownHours,"close-wait-seconds":o.authPopupConfig.closeWaitSeconds,onClose:o.handleAuthPopupClose},null,8,["show-popup","title","content","cooldown-hours","close-wait-seconds","onClose"])])}const le=W(fo,[["render",Yo],["__scopeId","data-v-ff579e9b"]]);export{le as default};
