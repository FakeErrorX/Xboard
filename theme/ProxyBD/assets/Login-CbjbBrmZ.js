import{_ as M,I as R,L as V,k as q,c as f,o as h,d as o,e as c,r,t as n,v as O,a as A,l as w,x as P,y as U,A as B,z as C,P as H,B as E,p as N,f as b,C as I,E as _,h as F,G as W,H as G,j as J,Q as j}from"./appInit-CGHXFw0-.js";import{A as x,I as z,a as Q,b as K,c as X,s as Y,v as D,d as Z}from"./authPopupState-BwxecuRU.js";import{h as $,a as oo}from"./tokenLogin-CcYAv57R.js";import"./index-sC8Xq0xY.js";import"./IconMail-DCQdTgWz.js";import"./IconArrowRight-CAdyv1A0.js";import"./IconEye-CnVKG0J1.js";import"./IconX-CVTrmr_B.js";const so={name:"LoginView",components:{ThemeToggle:q,LanguageSelector:V,IconMail:X,IconLock:R,IconArrowRight:K,IconEye:Q,IconEyeOff:z,AuthPopup:x},setup(){const t=J(),{t:e}=N(),{showToast:g}=W(),s=b("./images/logo.png"),S=()=>{s.value="/images/logo.png"},p=I({email:"",password:"",rememberMe:!1}),i=I({email:"",password:""}),d=b(!1),k=b(!1),m=b(!1),y=I({title:_.popup?.title||"",content:_.popup?.content||"",cooldownHours:_.popup?.cooldownHours||24,closeWaitSeconds:_.popup?.closeWaitSeconds||0}),L=()=>{m.value=!1};F(async()=>{if($()){d.value=!0;try{if((await oo({onLoginSuccess:()=>{console.log("Token verification login success")}})).success)return}catch(u){console.error("Error during token login:",u)}finally{d.value=!1}}if(new URLSearchParams(window.location.search).get("logout")==="true"){if(console.log("Detected recent logout; clearing login state"),g(e("auth.logoutSuccess"),"success",3e3),window.history&&window.history.replaceState){const u=window.location.href.replace("?logout=true","").replace("&logout=true","");window.history.replaceState({},document.title,u)}return}m.value=Y(_.popup);try{if(window._isLoggingOut===!0){console.log("Detected global logout flag; skip login status check");return}G()&&(console.log("User already logged in, redirecting to dashboard"),g(e("auth.alreadyLoggedIn"),"info"),setTimeout(()=>{t.push("/dashboard")},500))}catch(u){console.error("Login status check failed",u)}});const v=()=>{let a=!0;return i.email="",i.password="",D(p.email)?Z(p.email)||(i.email=e("validation.emailInvalid"),a=!1):(i.email=e("validation.emailRequired"),a=!1),D(p.password)||(i.password=e("validation.passwordRequired"),a=!1),a};return{formData:p,errors:i,loading:d,showPassword:k,handleLogin:async()=>{if(v()){d.value=!0;try{const a=await j(p);g(a.message||e("auth.loginSuccess"),"success",3e3),setTimeout(()=>{t.push("/dashboard")},300)}catch(a){g(a.response?.message||a.message||e("auth.loginFailed"),"error")}finally{d.value=!1}}},logoPath:s,handleLogoError:S,showAuthPopup:m,authPopupConfig:y,handleAuthPopupClose:L}}},eo={class:"auth-container"},to={class:"top-toolbar"},ao={class:"auth-card"},no={class:"auth-header"},lo={class:"auth-logo"},ro=["src"],io={class:"auth-title"},co={class:"auth-subtitle"},uo={class:"form-group"},ho={for:"email"},po={class:"input-with-icon"},go=["placeholder"],mo={key:0,class:"error-message"},fo={class:"form-group"},wo={for:"password"},_o={class:"input-with-icon"},vo=["type","placeholder"],bo={key:0,class:"error-message"},ko={class:"form-options"},yo={class:"remember-me"},Lo={class:"checkbox-container"},Po={class:"checkbox-label"},Io=["disabled"],So={key:0,class:"loading-wrapper"},To={key:1},Ao={class:"auth-footer"},Co={class:"auth-divider"},Eo={class:"auth-divider-text"};function Do(t,e,g,s,S,p){const i=r("ThemeToggle"),d=r("LanguageSelector"),k=r("IconMail"),m=r("IconLock"),y=r("IconEye"),L=r("IconEyeOff"),v=r("router-link"),T=r("IconArrowRight"),a=r("AuthPopup");return h(),f("div",eo,[e[9]||(e[9]=o("div",{class:"background-decoration"},[o("div",{class:"floating-ball ball-1"}),o("div",{class:"floating-ball ball-2"}),o("div",{class:"floating-ball ball-3"})],-1)),o("div",to,[c(i),c(d)]),o("div",ao,[o("div",no,[o("div",lo,[o("img",{src:s.logoPath,alt:"Logo",onError:e[0]||(e[0]=(...l)=>s.handleLogoError&&s.handleLogoError(...l))},null,40,ro)]),o("h1",io,n(t.$t("auth.loginTitle")),1),o("p",co,n(t.$t("auth.loginSubtitle")),1)]),o("form",{class:"auth-form",onSubmit:e[5]||(e[5]=O((...l)=>s.handleLogin&&s.handleLogin(...l),["prevent"]))},[o("div",uo,[o("label",ho,[w(n(t.$t("common.email"))+" ",1),e[6]||(e[6]=o("span",{class:"required"},"*",-1))]),o("div",po,[c(k,{class:"input-icon"}),P(o("input",{type:"email",id:"email","onUpdate:modelValue":e[1]||(e[1]=l=>s.formData.email=l),class:"form-control",placeholder:t.$t("auth.emailPlaceholder"),required:""},null,8,go),[[U,s.formData.email]])]),s.errors.email?(h(),f("div",mo,n(s.errors.email),1)):A("",!0)]),o("div",fo,[o("label",wo,[w(n(t.$t("common.password"))+" ",1),e[7]||(e[7]=o("span",{class:"required"},"*",-1))]),o("div",_o,[c(m,{class:"input-icon"}),P(o("input",{type:s.showPassword?"text":"password",id:"password","onUpdate:modelValue":e[2]||(e[2]=l=>s.formData.password=l),class:"form-control",placeholder:t.$t("auth.passwordPlaceholder"),required:""},null,8,vo),[[B,s.formData.password]]),o("div",{class:"password-toggle",onClick:e[3]||(e[3]=l=>s.showPassword=!s.showPassword)},[s.showPassword?(h(),C(L,{key:1})):(h(),C(y,{key:0}))])]),s.errors.password?(h(),f("div",bo,n(s.errors.password),1)):A("",!0)]),o("div",ko,[o("div",yo,[o("label",Lo,[P(o("input",{type:"checkbox","onUpdate:modelValue":e[4]||(e[4]=l=>s.formData.rememberMe=l)},null,512),[[H,s.formData.rememberMe]]),e[8]||(e[8]=o("span",{class:"checkmark"},null,-1)),o("span",Po,n(t.$t("common.rememberMe")),1)])]),c(v,{to:"/forgot-password",class:"forgot-password"},{default:E(()=>[w(n(t.$t("common.forgotPassword")),1)]),_:1})]),o("button",{type:"submit",class:"btn btn-primary btn-block",disabled:s.loading},[s.loading?(h(),f("span",So,[o("span",null,n(t.$t("common.loading")),1)])):(h(),f("span",To,[w(n(t.$t("common.login"))+" ",1),c(T,{class:"icon-right"})]))],8,Io)],32),o("div",Ao,[o("div",Co,[o("span",Eo,n(t.$t("auth.noAccount")),1)]),c(v,{to:"/register",class:"btn btn-secondary btn-block"},{default:E(()=>[w(n(t.$t("auth.createAccount")),1)]),_:1})])]),c(a,{"show-popup":s.showAuthPopup,title:s.authPopupConfig.title,content:s.authPopupConfig.content,"cooldown-hours":s.authPopupConfig.cooldownHours,"close-wait-seconds":s.authPopupConfig.closeWaitSeconds,onClose:s.handleAuthPopupClose},null,8,["show-popup","title","content","cooldown-hours","close-wait-seconds","onClose"])])}const Fo=M(so,[["render",Do],["__scopeId","data-v-fc0a41ed"]]);export{Fo as default};
