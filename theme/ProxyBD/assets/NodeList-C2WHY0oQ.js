import{Z as G,aB as A,_ as Q,p as B,f as r,g as P,aD as T,z as O,o as l,B as V,c,a as h,d as o,e as f,t,ai as _,b as L,l as I,$ as S,v as J,G as X,aM as F,h as Z,a0 as j,a9 as E,aj as H,ab as K}from"./appInit-CGHXFw0-.js";import{L as W}from"./LoadingSpinner-C-1wdek1.js";import{I as Y}from"./IconAlertTriangle-BKoak6h-.js";import{I as x,a as ee}from"./IconServer-Bex0g4Zk.js";import{I as oe}from"./IconArrowLeft-6FkQlYes.js";import{I as M}from"./IconCopy-CAlFAyvj.js";import{I as se}from"./IconLink-f4UxE49c.js";import{I as te,Q as ne}from"./browser-CinOknmz.js";import{I as ae}from"./IconX-CVTrmr_B.js";import"./index-sC8Xq0xY.js";/**
 * @license @tabler/icons-vue v3.35.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var ie=G("outline","dots-vertical","DotsVertical",[["path",{d:"M12 12m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0",key:"svg-0"}],["path",{d:"M12 19m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0",key:"svg-1"}],["path",{d:"M12 5m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0",key:"svg-2"}]]);function le(){return A({url:"/user/server/fetch",method:"get"}).then(d=>{if(typeof d=="object")return d;throw new Error("Invalid response format")}).catch(d=>{throw console.error("Error fetching server nodes:",d),d})}const de={class:"node-detail-modal-container"},ce={class:"node-detail-modal-header"},re={class:"modal-title"},ue={key:"info",class:"node-detail-modal-body"},ve={class:"node-info-section"},fe={class:"info-row"},he={class:"info-label"},pe={class:"info-value"},me={class:"info-row"},_e={class:"info-label"},ye={class:"info-row"},$e={class:"info-label"},ge={class:"info-value"},be={class:"info-row"},ke={class:"info-label"},we={class:"info-value"},Ce={key:0,class:"info-row"},Ie={class:"info-label"},Ne={class:"info-value"},Re={key:1,class:"info-row"},Ue={class:"info-label"},qe={class:"info-value"},Le={key:2,class:"info-row"},De={class:"info-label"},Te={class:"info-value"},Fe={class:"page-nav-btn-container"},ze={key:"subscribe",class:"node-detail-modal-body"},Ve={class:"quick-link-section"},Se={class:"section-header"},je={class:"view-toggle"},Ee={key:0,class:"link-card"},Me={class:"link-text"},Qe={key:1,class:"qrcode-container"},Be={key:0,class:"qrcode-loading"},Oe={key:1,class:"qrcode-wrapper"},Ge=["src"],Ae={class:"page-nav-btn-container"},Pe={__name:"NodeDetailModal",props:{show:{type:Boolean,default:!1},node:{type:Object,default:()=>({})},userInfo:{type:Object,default:()=>({})}},emits:["close"],setup(d,{emit:R}){const{t:u}=B(),{showToast:p}=X(),e=d,b=R,y=r("info"),k=r("slide-left"),N=s=>{s==="subscribe"?k.value="slide-left":k.value="slide-right",y.value=s},v=r("link"),w=r(""),m=r(!1),U=()=>{b("close"),setTimeout(()=>{y.value="info"},300)},q=s=>btoa(encodeURIComponent(s).replace(/%([0-9A-F]{2})/g,(a,n)=>String.fromCharCode(parseInt(n,16)))),g=P(()=>{let s=e.node.type?.toLowerCase();if(!s||!e.node.host||!e.node.port)return u("nodes.invalidNodeData")||"Incomplete node data, cannot generate link";s==="shadowsocks"&&(s="ss");const a=e.userInfo?.uuid||"00000000-0000-0000-0000-000000000000";switch(s){case"ss":{const $=`${e.node.cipher||"chacha20-ietf-poly1305"}:${a}@${e.node.host}:${e.node.port}`;return`ss://${q($)}`}case"vmess":{const n={v:"2",ps:e.node.name,add:e.node.host,port:e.node.port,id:a,aid:"0",net:e.node.network||"tcp",type:"none",host:e.node.host,path:e.node.path||"/",tls:e.node.tls===1?"tls":""};return`vmess://${q(JSON.stringify(n))}`}case"vless":{let n=`vless://${a}@${e.node.host}:${e.node.port}?encryption=none`;e.node.flow&&(n+=`&flow=${encodeURIComponent(e.node.flow)}`);const $=e.node.network||"tcp";if(n+=`&type=${encodeURIComponent($)}`,n+="&headerType=none",e.node.tls){const z=e.node.tls===2?"reality":"tls";n+=`&security=${z}`,e.node.tls===2&&e.node.tls_settings&&(e.node.tls_settings.server_name&&(n+=`&sni=${encodeURIComponent(e.node.tls_settings.server_name)}`),n+=`&fp=${encodeURIComponent(e.node.tls_settings?.fingerprint||"chrome")}`,e.node.tls_settings.public_key&&(n+=`&pbk=${encodeURIComponent(e.node.tls_settings.public_key)}`),e.node.tls_settings.short_id&&(n+=`&sid=${encodeURIComponent(e.node.tls_settings.short_id)}`),e.node.tls_settings.server_port&&e.node.tls_settings.server_port!==e.node.port.toString()&&(n+=`&port=${encodeURIComponent(e.node.tls_settings.server_port)}`),e.node.tls_settings.allow_insecure==="1"&&(n+="&allowInsecure=1"))}return e.node.path&&(n+=`&path=${encodeURIComponent(e.node.path)}`),n+=`#${encodeURIComponent(e.node.name)}`,n}case"trojan":{let n=`trojan://${a}@${e.node.host}:${e.node.port}`;return e.node.allow_insecure&&(n+="?allowInsecure=1"),n+=`#${encodeURIComponent(e.node.name)}`,n}case"hysteria":{let n=`hysteria2://${a}@${e.node.host}:${e.node.port}`;const $=[];return e.node.sni&&$.push(`sni=${encodeURIComponent(e.node.sni)}`),$.push(`insecure=${e.node.allow_insecure?"1":"0"}`),$.length>0&&(n+=`?${$.join("&")}`),n+=`#${encodeURIComponent(e.node.name)}`,n}default:return u("nodes.unsupportedNodeType")||"Unsupported type"}}),C=()=>{if(g.value){m.value=!0;try{ne.toDataURL(g.value,{width:200,margin:2,color:{dark:"#000000",light:"#ffffff"}}).then(s=>{w.value=s,m.value=!1}).catch(s=>{console.error("QR code generation failed:",s),m.value=!1,p(u("common.qrCodeGenerationFailed")||"QR code generation failed","error")})}catch(s){console.error("Failed to generate QR code:",s),m.value=!1,p(u("common.qrCodeGenerationFailed")||"QR code generation failed","error")}}},i=()=>{m.value=!1},D=()=>{navigator.clipboard.writeText(g.value).then(()=>{p(u("common.copied")||"Copied to clipboard","success")}).catch(s=>{console.error("Unable to copy link: ",s);try{const a=document.createElement("textarea");a.value=g.value,a.style.position="fixed",document.body.appendChild(a),a.focus(),a.select();const n=document.execCommand("copy");document.body.removeChild(a),n?p(u("common.copied")||"Copied to clipboard","success"):p(u("common.copyFailed")||"Copy failed","error")}catch(a){console.error("Fallback copy method failed:",a),p(u("common.copyFailed")||"Copy failed","error")}})};return T(()=>{v.value==="qrcode"&&e.show&&y.value==="subscribe"&&C()}),T(()=>{e.show&&v.value==="qrcode"&&y.value==="subscribe"&&C()}),T(()=>{y.value==="subscribe"&&v.value==="qrcode"&&e.show&&C()}),(s,a)=>(l(),O(S,{name:"fade"},{default:V(()=>[d.show?(l(),c("div",{key:0,class:"node-detail-modal-overlay",onClick:J(U,["self"])},[o("div",de,[o("div",ce,[o("h3",re,t(d.node.name),1),o("button",{class:"modal-close-btn",onClick:U},[f(_(ae),{size:20})])]),f(S,{name:k.value,mode:"out-in"},{default:V(()=>[y.value==="info"?(l(),c("div",ue,[o("div",ve,[o("div",fe,[o("span",he,t(s.$t("nodes.type"))+":",1),o("span",pe,t(d.node.type),1)]),o("div",me,[o("span",_e,t(s.$t("nodes.rate"))+":",1),o("span",{class:L(["info-value",{"high-rate":parseFloat(d.node.rate)!=1}])},"x"+t(d.node.rate),3)]),o("div",ye,[o("span",$e,t(s.$t("nodes.host"))+":",1),o("span",ge,t(d.node.host),1)]),o("div",be,[o("span",ke,t(s.$t("nodes.port"))+":",1),o("span",we,t(d.node.port),1)]),d.node.type==="ss"||d.node.type==="shadowsocks"?(l(),c("div",Ce,[o("span",Ie,t(s.$t("nodes.cipher"))+":",1),o("span",Ne,t(d.node.cipher),1)])):h("",!0),d.node.type==="trojan"?(l(),c("div",Re,[o("span",Ue,t(s.$t("nodes.security"))+":",1),o("span",qe,t(d.node.allow_insecure?s.$t("nodes.allowInsecure"):s.$t("nodes.secure")),1)])):h("",!0),d.node.type==="vmess"?(l(),c("div",Le,[o("span",De,t(s.$t("nodes.tls")||"TLS")+":",1),o("span",Te,t(d.node.tls===1?s.$t("common.on"):s.$t("common.off")),1)])):h("",!0)]),o("div",Fe,[o("button",{class:"page-nav-btn",onClick:a[0]||(a[0]=n=>N("subscribe"))},[f(_(se),{size:16}),I(" "+t(s.$t("nodes.viewSubscribeLink")),1)])])])):y.value==="subscribe"?(l(),c("div",ze,[o("div",Ve,[o("div",Se,[o("h4",null,t(s.$t("nodes.quickLink")),1),o("div",je,[o("button",{class:L(["toggle-btn",{active:v.value==="link"}]),onClick:a[1]||(a[1]=n=>v.value="link")},[f(_(x),{size:16}),I(" "+t(s.$t("nodes.linkView")),1)],2),o("button",{class:L(["toggle-btn",{active:v.value==="qrcode"}]),onClick:a[2]||(a[2]=n=>v.value="qrcode")},[f(_(te),{size:16}),I(" "+t(s.$t("nodes.qrcodeView")),1)],2)])]),v.value==="link"?(l(),c("div",Ee,[o("pre",Me,t(g.value),1),o("button",{class:"copy-btn",onClick:D},[f(_(M),{size:16}),I(" "+t(s.$t("common.copy")),1)])])):v.value==="qrcode"?(l(),c("div",Qe,[m.value?(l(),c("div",Be,[a[4]||(a[4]=o("div",{class:"loader"},null,-1)),o("p",null,t(s.$t("common.loadingQRCode")),1)])):(l(),c("div",Oe,[o("img",{src:w.value,alt:"QR Code",onLoad:i},null,40,Ge),o("button",{class:"copy-btn",onClick:D},[f(_(M),{size:16}),I(" "+t(s.$t("common.copy")),1)])]))])):h("",!0)]),o("div",Ae,[o("button",{class:"page-nav-btn",onClick:a[3]||(a[3]=n=>N("info"))},[f(_(oe),{size:16}),I(" "+t(s.$t("common.back")),1)])])])):h("",!0)]),_:1},8,["name"])])])):h("",!0)]),_:1}))}},Je=Q(Pe,[["__scopeId","data-v-18c736d8"]]),Xe={class:"nodes-container"},Ze={class:"nodes-inner"},He={class:"dashboard-card welcome-card"},Ke={class:"card-header"},We={class:"card-title"},Ye={class:"card-body"},xe={key:0,class:"nodes-loading"},eo={key:1,class:"nodes-error"},oo={key:2,class:"nodes-content"},so={class:"node-items"},to={class:"node-status"},no={class:"node-info"},ao={class:"node-tags"},io={key:0,class:"node-tag rate-tag"},lo={class:"node-tag type-tag"},co={class:"node-name"},ro={key:0,class:"node-host"},uo={key:0,class:"node-actions"},vo=["onClick"],fo={key:3,class:"nodes-empty"},ho={__name:"NodeList",setup(d){const{t:R}=B(),u=K("$toast"),p=r(!0),e=r(""),b=r([]),y=r(F.showNodeDetails),k=r(F.showNodeRate),N=r(F.allowViewNodeInfo),v=r(null),w=r(!1),m=r(null),U=i=>{m.value=i,w.value=!0},q=()=>{w.value=!1,setTimeout(()=>{m.value=null},300)},g=async()=>{try{const i=await H();i&&i.data&&(v.value=i.data)}catch(i){console.error("Failed to fetch user info:",i),u&&u.error(R("common.userInfoError")||"Failed to fetch user info")}},C=async()=>{p.value=!0,e.value="";try{const i=await le();i&&i.data?b.value=i.data:b.value=[]}catch(i){console.error("Failed to fetch nodes:",i),e.value=i.response?.message||(i&&i.message?i.message:R("common.networkError")||"Network error"),u&&u.error(e.value)}finally{p.value=!1}};return Z(()=>{g(),C()}),(i,D)=>(l(),c("div",Xe,[o("div",Ze,[o("div",He,[o("div",Ke,[o("h2",We,t(i.$t("nodes.welcome.title")||"Node List"),1)]),o("div",Ye,[o("p",null,t(i.$t("nodes.welcome.description")||"View and use available server nodes"),1)])]),p.value?(l(),c("div",xe,[f(W),o("p",null,t(i.$t("nodes.loading")||"Loading nodes..."),1)])):e.value?(l(),c("div",eo,[f(_(Y),{size:48,class:"error-icon"}),o("p",null,t(e.value),1),o("button",{class:"retry-button",onClick:C},t(i.$t("common.retry")||"Retry"),1)])):b.value.length>0?(l(),c("div",oo,[o("div",so,[(l(!0),c(j,null,E(b.value,s=>(l(),c("div",{key:s.id,class:"node-item"},[o("div",to,[o("div",{class:L(["status-indicator",{online:s.is_online===1}])},null,2)]),o("div",no,[o("div",ao,[k.value?(l(),c("span",io,"x"+t(s.rate),1)):h("",!0),o("span",lo,t(s.type),1),s.tags&&s.tags.length>0?(l(!0),c(j,{key:1},E(s.tags,(a,n)=>(l(),c("span",{key:n,class:"node-tag"},t(a),1))),128)):h("",!0)]),o("h3",co,t(s.name),1),y.value?(l(),c("p",ro,t(s.host)+":"+t(s.port),1)):h("",!0)]),k.value&&N.value?(l(),c("div",uo,[o("button",{class:"more-btn",onClick:a=>U(s)},[f(_(ie),{size:20})],8,vo)])):h("",!0)]))),128))])])):(l(),c("div",fo,[f(_(ee),{size:48,class:"empty-icon"}),o("p",null,t(i.$t("nodes.noNodes")||"No nodes available"),1)]))]),N.value?(l(),O(Je,{key:0,show:w.value,node:m.value,userInfo:v.value,onClose:q},null,8,["show","node","userInfo"])):h("",!0)]))}},Io=Q(ho,[["__scopeId","data-v-46403930"]]);export{Io as default};
