import{Z as Ie,G as Te,_ as Se,ag as Me,p as De,f as n,g as Fe,w as Ee,h as Re,ah as W,c as i,o as l,d as e,e as f,t,a8 as ze,ai as u,a as p,x as S,y as N,z as ie,l as w,b as G,P as ne,a0 as X,a9 as de,B as Z,$ as H,aj as Be,ak as Ue,al as Ve,am as Ne,an as Ge,j as Ae,ao as Le,ap as Oe,aq as qe,ar as je,as as Ke,af as We,v as J,a5 as Y,at as Xe,au as Ze}from"./appInit-CGHXFw0-.js";import{I as He}from"./IconAlertTriangle-BKoak6h-.js";import{I as re}from"./IconBrandTelegram-BTkfzYu6.js";import{I as ce}from"./IconCopy-CAlFAyvj.js";import{I as ue}from"./IconDeviceMobile-CvoVo5Ai.js";import{I as Je}from"./IconDevices-BdxdBIDS.js";import{I as Ye}from"./IconLock-Dm1Qu8SN.js";import{I as Qe}from"./IconRefresh-DEF_LKdU.js";import{I as Q}from"./IconX-CVTrmr_B.js";import"./index-sC8Xq0xY.js";/**
 * @license @tabler/icons-vue v3.35.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var ve=Ie("outline","browser","Browser",[["path",{d:"M4 8h16",key:"svg-0"}],["path",{d:"M4 4m0 2a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v12a2 2 0 0 1 -2 2h-12a2 2 0 0 1 -2 -2z",key:"svg-1"}],["path",{d:"M8 4v4",key:"svg-2"}]]);function xe(){const{showToast:M}=Te();return{success:(r,m=3e3)=>{M(r,"success",m)},error:(r,m=3e3)=>{M(r,"error",m)},warning:(r,m=3e3)=>{M(r,"warning",m)},info:(r,m=3e3)=>{M(r,"info",m)}}}const es={class:"profile-container"},ss={class:"profile-inner"},os={class:"dashboard-card welcome-card"},ts={class:"card-header"},as={class:"card-title"},ls={class:"card-body"},is={key:0,class:"profile-skeleton"},ns={key:1,class:"error-state"},ds={key:2,class:"profile-content"},rs={class:"profile-card"},cs={class:"card-header"},us={class:"info-content"},vs={class:"info-list"},fs={class:"info-item"},ps={class:"info-label"},ms={class:"info-value"},hs={class:"info-item"},_s={class:"info-label"},gs={class:"info-value"},ws={key:0,class:"profile-card"},ks={class:"card-header"},bs={class:"settings-content"},ys={class:"gift-card-form"},$s={class:"input-group"},Cs=["placeholder"],Ps=["disabled"],Is={key:0,class:"loader"},Ts={class:"profile-card"},Ss={class:"card-header"},Ms={class:"settings-content"},Ds={class:"setting-item"},Fs={class:"setting-info"},Es={class:"setting-label"},Rs={class:"setting-description"},zs={class:"setting-toggle"},Bs=["disabled"],Us={class:"setting-item"},Vs={class:"setting-info"},Ns={class:"setting-label"},Gs={class:"setting-description"},As={class:"setting-toggle"},Ls=["disabled"],Os={class:"profile-card"},qs={class:"card-header"},js={class:"settings-content"},Ks={class:"action-buttons"},Ws={key:1,class:"profile-card"},Xs={class:"card-header"},Zs={class:"settings-content"},Hs={key:0,class:"telegram-loading"},Js={class:"action-buttons"},Ys={class:"profile-card"},Qs={class:"card-header"},xs={class:"settings-content"},eo={class:"action-buttons"},so={key:0,class:"subscription-info"},oo={class:"subscription-url"},to={key:2,class:"profile-card"},ao={class:"card-header"},lo={class:"settings-content"},io={key:0,class:"device-loading"},no={key:1,class:"device-error"},ro={key:2,class:"device-empty"},co={key:3,class:"device-list"},uo={class:"device-icon"},vo={class:"device-info"},fo={class:"device-name"},po={class:"device-meta"},mo={class:"device-ip"},ho={class:"device-time"},_o={class:"modal-header"},go={class:"modal-body"},wo={class:"form-group"},ko=["placeholder"],bo={class:"form-group"},yo=["placeholder"],$o={class:"form-group"},Co=["placeholder"],Po={key:0,class:"error-text"},Io={class:"modal-footer"},To=["disabled"],So={key:0,class:"loader"},Mo={class:"modal-header"},Do={class:"modal-body"},Fo={class:"modal-footer"},Eo=["disabled"],Ro={key:0,class:"loader"},zo={class:"modal-header"},Bo={class:"modal-body"},Uo={class:"step-container"},Vo={class:"step-item"},No={class:"step-number"},Go={class:"step-content"},Ao=["href"],Lo={class:"step-item"},Oo={class:"step-number"},qo={class:"step-content"},jo={class:"command-container"},Ko={class:"command-text"},Wo={class:"modal-footer"},Xo=Object.assign({name:"UserProfile"},{__name:"UserProfile",setup(M){Me();const{t:d}=De(),{success:b,error:y}=xe(),_=n(!0),r=n(""),m=n({}),k=n(!1),C=n(!1),z=n(!1),B=n(!1),D=n(!1),F=n(!1),g=n(""),$=n({is_telegram:0,telegram_discuss_link:""}),h=n(null),P=n(!1),fe=n(""),A=n(!1),L=n([]),E=n(!1),R=n(""),I=n(""),U=n(!1),T=n(!1),O=n(!1),q=n(!1),c=n({oldPassword:"",newPassword:"",confirmPassword:""}),x=Fe(()=>c.value.confirmPassword?c.value.newPassword!==c.value.confirmPassword:!1),ee=()=>c.value.oldPassword&&c.value.newPassword&&c.value.confirmPassword&&!x.value,j=Ge(),se=Ae(),V=async(s=!0)=>{s&&(_.value=!0),r.value="";try{const o=await Be();o&&o.data?(m.value=o.data,D.value=!!o.data.remind_expire,F.value=!!o.data.remind_traffic,await pe()):r.value=d("common.unknownError")}catch(o){console.error("Failed to fetch user info:",o),r.value=o?.message||d("common.networkError"),y(r.value)}finally{s&&!P.value&&!E.value&&(_.value=!1),oe()}},oe=()=>{j.query.openPasswordModal==="true"&&setTimeout(()=>{k.value=!0;const s={...j.query};delete s.openPasswordModal,se.replace({query:s})},500)};Ee(()=>j.query,s=>{s.openPasswordModal==="true"&&setTimeout(()=>{k.value=!0;const o={...s};delete o.openPasswordModal,se.replace({query:o})},500)},{immediate:!0});const pe=async()=>{try{const s=await qe();s&&s.data&&(g.value=s.data.subscribe_url||"")}catch(s){console.error("Failed to fetch subscribe info:",s)}},me=async()=>{P.value=!0,fe.value="";try{const s=await Ve();s&&s.data&&($.value=s.data);try{const o=await Ne();o&&o.data&&(o.data.message&&o.data.message.includes("Not Found")?h.value=null:h.value=o.data)}catch(o){console.error("Failed to fetch Telegram bot info:",o),h.value=null}}catch(s){console.error("Failed to fetch Telegram info:",s),$.value=null,h.value=null}finally{P.value=!1,!_.value&&!E.value&&(_.value=!1)}},he=()=>{$.value&&$.value.telegram_discuss_link&&window.open($.value.telegram_discuss_link,"_blank")},_e=()=>{A.value=!0},K=()=>{A.value=!1},ge=()=>{if(h.value&&g.value){const s=`/bind ${g.value}`;navigator.clipboard.writeText(s).then(()=>{b(d("profile.commandCopied"))}).catch(o=>{console.error("Failed to copy command:",o),r(d("common.copyFailed"))})}},te=async s=>{T.value=!0,s==="expire"?O.value=!0:s==="traffic"&&(q.value=!0);try{const o={remind_expire:D.value?1:0,remind_traffic:F.value?1:0},a=await Oe(o);a&&a.data&&b(d("profile.updateSuccess"))}catch(o){console.error("Failed to update remind settings:",o),D.value=!!m.value.remind_expire,F.value=!!m.value.remind_traffic,y(d("profile.updateError"))}finally{await V(!1),T.value=!1,O.value=!1,q.value=!1}},we=async()=>{if(ee()){z.value=!0;try{const s={old_password:c.value.oldPassword,new_password:c.value.newPassword},o=await Xe(s);o&&o.data&&(b(d("profile.passwordChanged")),c.value={oldPassword:"",newPassword:"",confirmPassword:""},k.value=!1)}catch(s){console.error("Failed to change password:",s),y(d("profile.passwordError"))}finally{z.value=!1}}},ke=async()=>{B.value=!0;try{const s=await Ze();s&&s.data&&(g.value=s.data,b(d("profile.resetSuccess")),C.value=!1)}catch(s){console.error("Failed to reset security:",s),y(d("profile.resetError"))}finally{B.value=!1}},be=()=>{g.value&&navigator.clipboard.writeText(g.value).then(()=>{b(d("profile.subscriptionCopied"))}).catch(s=>{console.error("Failed to copy text:",s)})},ye=async()=>{if(!I.value){y(d("profile.giftCardEmpty"));return}U.value=!0;try{const s=await Le(I.value);s&&s.data&&(b(d("profile.giftCardSuccess")),I.value="",await V(!1))}catch(s){console.error("Failed to redeem gift card:",s),y(d("profile.giftCardError"))}finally{U.value=!1}},ae=async()=>{E.value=!0,R.value="";try{const s=await Ue();if(s&&s.data){const a=(Array.isArray(s.data)?s.data:typeof s.data=="object"&&s.data!==null?Object.values(s.data):[]).sort((v,le)=>!v.login_at||!le.login_at?0:le.login_at-v.login_at);L.value=a.slice(0,10)}else R.value=d("profile.sessionError")}catch(s){console.error("Failed to fetch active sessions:",s),R.value=s?.message||d("common.networkError")}finally{E.value=!1,!_.value&&!P.value&&(_.value=!1)}},$e=s=>{if(!s)return ve;const o=s.toLowerCase();return o.includes("iphone")||o.includes("ipad")||o.includes("ipod")?ue:o.includes("android")?ue:o.includes("windows")?Y:o.includes("macintosh")||o.includes("mac os")?Y:o.includes("linux")?Y:ve},Ce=s=>{if(!s)return d("profile.unknownDevice");const o=s.toLowerCase();let a="",v="";return o.includes("iphone")?a="iPhone":o.includes("ipad")?a="iPad":o.includes("ipod")?a="iPod":o.includes("android")?a="Android":o.includes("windows")?a="Windows":o.includes("macintosh")||o.includes("mac os")?a="MacOS":o.includes("linux")?a="Linux":a=d("profile.unknownDevice"),o.includes("edg/")||o.includes("edge/")?v="Edge":o.includes("chrome/")&&!o.includes("chromium/")?v="Chrome":o.includes("firefox/")?v="Firefox":o.includes("safari/")&&!o.includes("chrome/")&&!o.includes("android")?v="Safari":o.includes("opera/")||o.includes("opr/")?v="Opera":v=d("profile.unknownBrowser"),`${a} - ${v}`},Pe=s=>{if(!s)return"";const o=Number(s);if(isNaN(o))return"";if(o<0||o>4102444800)return console.error("Invalid timestamp:",s),"";try{const a=new Date(o*1e3),v={year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"};return new Intl.DateTimeFormat("en-US",v).format(a)}catch(a){return console.error("Error formatting timestamp:",a),""}};return Re(()=>{_.value=!0,Promise.all([V(!1),W.showRecentDevices?ae():Promise.resolve(),me()]).finally(()=>{_.value=!1,oe()})}),(s,o)=>(l(),i(X,null,[e("div",es,[e("div",ss,[e("div",os,[e("div",ts,[e("h2",as,t(s.$t("profile.title")),1)]),e("div",ls,[e("p",null,t(s.$t("common.welcome")),1)])]),_.value?(l(),i("div",is,[...o[19]||(o[19]=[ze('<div class="profile-card" data-v-d8e5f5ee><div class="card-header" data-v-d8e5f5ee><div class="skeleton-line skeleton-title" data-v-d8e5f5ee></div></div><div class="skeleton-content" data-v-d8e5f5ee><div class="skeleton-item" data-v-d8e5f5ee><div class="skeleton-label" data-v-d8e5f5ee></div><div class="skeleton-value" data-v-d8e5f5ee></div></div><div class="skeleton-item" data-v-d8e5f5ee><div class="skeleton-label" data-v-d8e5f5ee></div><div class="skeleton-value" data-v-d8e5f5ee></div></div></div></div><div class="profile-card" data-v-d8e5f5ee><div class="card-header" data-v-d8e5f5ee><div class="skeleton-line skeleton-title" data-v-d8e5f5ee></div></div><div class="skeleton-content" data-v-d8e5f5ee><div class="skeleton-item skeleton-setting" data-v-d8e5f5ee><div class="skeleton-text" data-v-d8e5f5ee><div class="skeleton-label" data-v-d8e5f5ee></div><div class="skeleton-description" data-v-d8e5f5ee></div></div><div class="skeleton-toggle" data-v-d8e5f5ee></div></div><div class="skeleton-item skeleton-setting" data-v-d8e5f5ee><div class="skeleton-text" data-v-d8e5f5ee><div class="skeleton-label" data-v-d8e5f5ee></div><div class="skeleton-description" data-v-d8e5f5ee></div></div><div class="skeleton-toggle" data-v-d8e5f5ee></div></div></div></div><div class="profile-card" data-v-d8e5f5ee><div class="card-header" data-v-d8e5f5ee><div class="skeleton-line skeleton-title" data-v-d8e5f5ee></div></div><div class="skeleton-content" data-v-d8e5f5ee><div class="skeleton-button" data-v-d8e5f5ee></div></div></div>',3)])])):r.value?(l(),i("div",ns,[f(u(He),{size:48,class:"error-icon"}),e("p",null,t(r.value),1),e("button",{class:"retry-button",onClick:V},t(s.$t("common.retry")),1)])):(l(),i("div",ds,[e("div",rs,[e("div",cs,[e("h3",null,t(s.$t("profile.basicInfo")),1)]),e("div",us,[e("div",vs,[e("div",fs,[e("span",ps,t(s.$t("profile.email")),1),e("span",ms,t(m.value.email),1)]),e("div",hs,[e("span",_s,t(s.$t("profile.createdAt")),1),e("span",gs,t(u(je)(m.value.created_at)),1)])])])]),u(W).showGiftCardRedeem?(l(),i("div",ws,[e("div",ks,[e("h3",null,t(s.$t("profile.giftCard")),1)]),e("div",bs,[e("div",ys,[e("div",$s,[S(e("input",{type:"text","onUpdate:modelValue":o[0]||(o[0]=a=>I.value=a),placeholder:s.$t("profile.giftCardPlaceholder"),class:"gift-card-input"},null,8,Cs),[[N,I.value]]),e("button",{class:"gift-card-btn",onClick:ye,disabled:U.value||!I.value},[U.value?(l(),i("span",Is)):(l(),ie(u(Ke),{key:1,size:18})),w(" "+t(s.$t("profile.giftCardSubmit")),1)],8,Ps)])])])])):p("",!0),e("div",Ts,[e("div",Ss,[e("h3",null,t(s.$t("profile.notifications")),1)]),e("div",Ms,[e("div",Ds,[e("div",Fs,[e("span",Es,t(s.$t("profile.expireRemind")),1),e("span",Rs,t(s.$t("profile.expireRemindDesc")),1)]),e("div",zs,[e("label",{class:G(["switch",{disabled:T.value}])},[S(e("input",{type:"checkbox","onUpdate:modelValue":o[1]||(o[1]=a=>D.value=a),onChange:o[2]||(o[2]=a=>te("expire")),disabled:T.value},null,40,Bs),[[ne,D.value]]),e("span",{class:G(["slider round",{loading:O.value}])},null,2)],2)])]),e("div",Us,[e("div",Vs,[e("span",Ns,t(s.$t("profile.trafficRemind")),1),e("span",Gs,t(s.$t("profile.trafficRemindDesc")),1)]),e("div",As,[e("label",{class:G(["switch",{disabled:T.value}])},[S(e("input",{type:"checkbox","onUpdate:modelValue":o[3]||(o[3]=a=>F.value=a),onChange:o[4]||(o[4]=a=>te("traffic")),disabled:T.value},null,40,Ls),[[ne,F.value]]),e("span",{class:G(["slider round",{loading:q.value}])},null,2)],2)])])])]),e("div",Os,[e("div",qs,[e("h3",null,t(s.$t("profile.security")),1)]),e("div",js,[e("div",Ks,[e("button",{class:"action-btn",onClick:o[5]||(o[5]=a=>k.value=!0)},[f(u(Ye),{size:18}),w(" "+t(s.$t("profile.changePassword")),1)])])])]),($.value?.telegram_discuss_link||h.value&&h.value.username)&&!P.value?(l(),i("div",Ws,[e("div",Xs,[e("h3",null,t(s.$t("profile.telegram")),1)]),e("div",Zs,[P.value?(l(),i("div",Hs,[...o[20]||(o[20]=[e("div",{class:"skeleton-wrapper"},[e("div",{class:"skeleton-line",style:{width:"80%",height:"40px","margin-bottom":"12px"}}),e("div",{class:"skeleton-line",style:{width:"60%",height:"40px"}})],-1)])])):p("",!0),e("div",Js,[$.value?.telegram_discuss_link?(l(),i("button",{key:0,class:"action-btn",onClick:he},[f(u(re),{size:18}),w(" "+t(s.$t("profile.telegramGroup")),1)])):p("",!0),h.value&&h.value.username?(l(),i("button",{key:1,class:"action-btn",onClick:_e},[f(u(re),{size:18}),w(" "+t(s.$t("profile.telegramBot")),1)])):p("",!0)])])])):p("",!0),e("div",Ys,[e("div",Qs,[e("h3",null,t(s.$t("profile.subscription")),1)]),e("div",xs,[e("div",eo,[e("button",{class:"action-btn danger",onClick:o[6]||(o[6]=a=>C.value=!0)},[f(u(Qe),{size:18}),w(" "+t(s.$t("profile.resetSecurity")),1)]),g.value?(l(),i("button",{key:0,class:"action-btn",onClick:be},[f(u(ce),{size:18}),w(" "+t(s.$t("profile.copySubscription")),1)])):p("",!0)]),g.value?(l(),i("div",so,[e("div",oo,t(g.value),1)])):p("",!0)])]),u(W).showRecentDevices?(l(),i("div",to,[e("div",ao,[e("h3",null,t(s.$t("profile.recentDevices")),1)]),e("div",lo,[E.value?(l(),i("div",io,[(l(),i(X,null,de(3,a=>e("div",{class:"session-skeleton",key:a},[...o[21]||(o[21]=[e("div",{class:"session-skeleton-icon"},null,-1),e("div",{class:"session-skeleton-content"},[e("div",{class:"session-skeleton-title"}),e("div",{class:"session-skeleton-info"})],-1)])])),64))])):R.value?(l(),i("div",no,[e("p",null,t(R.value),1),e("button",{class:"refresh-btn",onClick:ae},t(s.$t("common.retry")),1)])):L.value.length===0?(l(),i("div",ro,[f(u(Je),{size:48,class:"empty-icon"}),e("p",null,t(s.$t("profile.noDevices")),1)])):(l(),i("div",co,[(l(!0),i(X,null,de(L.value,(a,v)=>(l(),i("div",{key:v,class:"device-item"},[e("div",uo,[(l(),ie(We($e(a.ua)),{size:24}))]),e("div",vo,[e("div",fo,t(Ce(a.ua)),1),e("div",po,[e("span",mo,t(a.ip||s.$t("profile.unknownIP")),1),e("span",ho,t(Pe(a.login_at)),1)])])]))),128))]))])])):p("",!0)])),f(H,{name:"modal-fade"},{default:Z(()=>[k.value?(l(),i("div",{key:0,class:"modal-overlay",onClick:o[13]||(o[13]=a=>k.value=!1)},[e("div",{class:"modal-content",onClick:o[12]||(o[12]=J(()=>{},["stop"]))},[e("div",_o,[e("h3",null,t(s.$t("profile.changePasswordTitle")),1),e("button",{class:"modal-close",onClick:o[7]||(o[7]=a=>k.value=!1)},[f(u(Q),{size:20})])]),e("div",go,[e("div",wo,[e("label",null,t(s.$t("profile.oldPassword")),1),S(e("input",{type:"password","onUpdate:modelValue":o[8]||(o[8]=a=>c.value.oldPassword=a),placeholder:s.$t("profile.oldPassword")},null,8,ko),[[N,c.value.oldPassword]])]),e("div",bo,[e("label",null,t(s.$t("profile.newPassword")),1),S(e("input",{type:"password","onUpdate:modelValue":o[9]||(o[9]=a=>c.value.newPassword=a),placeholder:s.$t("profile.newPassword")},null,8,yo),[[N,c.value.newPassword]])]),e("div",$o,[e("label",null,t(s.$t("profile.confirmPassword")),1),S(e("input",{type:"password","onUpdate:modelValue":o[10]||(o[10]=a=>c.value.confirmPassword=a),placeholder:s.$t("profile.confirmPassword")},null,8,Co),[[N,c.value.confirmPassword]]),x.value?(l(),i("div",Po,t(s.$t("profile.passwordMismatch")),1)):p("",!0)])]),e("div",Io,[e("button",{class:"btn-cancel",onClick:o[11]||(o[11]=a=>k.value=!1)},t(s.$t("common.cancel")),1),e("button",{class:"btn-submit",onClick:we,disabled:z.value||!ee()},[z.value?(l(),i("span",So)):p("",!0),w(" "+t(s.$t("common.submit")),1)],8,To)])])])):p("",!0)]),_:1}),f(H,{name:"modal-fade"},{default:Z(()=>[C.value?(l(),i("div",{key:0,class:"modal-overlay",onClick:o[17]||(o[17]=a=>C.value=!1)},[e("div",{class:"modal-content",onClick:o[16]||(o[16]=J(()=>{},["stop"]))},[e("div",Mo,[e("h3",null,t(s.$t("profile.resetSecurityTitle")),1),e("button",{class:"modal-close",onClick:o[14]||(o[14]=a=>C.value=!1)},[f(u(Q),{size:20})])]),e("div",Do,[e("p",null,t(s.$t("profile.resetSecurityConfirm")),1)]),e("div",Fo,[e("button",{class:"btn-cancel",onClick:o[15]||(o[15]=a=>C.value=!1)},t(s.$t("common.cancel")),1),e("button",{class:"btn-submit danger",onClick:ke,disabled:B.value},[B.value?(l(),i("span",Ro)):p("",!0),w(" "+t(s.$t("common.confirm")),1)],8,Eo)])])])):p("",!0)]),_:1})]),o[22]||(o[22]=e("div",{class:"bottom-safe-area"},null,-1))]),f(H,{name:"modal-fade"},{default:Z(()=>[A.value?(l(),i("div",{key:0,class:"modal-overlay",onClick:K},[e("div",{class:"modal-content",onClick:o[18]||(o[18]=J(()=>{},["stop"]))},[e("div",zo,[e("h3",null,t(s.$t("profile.bindTelegram")),1),e("button",{class:"modal-close",onClick:K},[f(u(Q),{size:20})])]),e("div",Bo,[e("div",Uo,[e("div",Vo,[e("div",No,t(s.$t("profile.telegramStep1")),1),e("div",Go,[e("p",null,[w(t(s.$t("profile.telegramSearchTip"))+" ",1),e("a",{href:`https://t.me/${h.value?.username}`,target:"_blank",class:"tg-link"}," @"+t(h.value?.username),9,Ao)])])]),e("div",Lo,[e("div",Oo,t(s.$t("profile.telegramStep2")),1),e("div",qo,[e("p",null,t(s.$t("profile.telegramSendCommand")),1),e("div",jo,[e("pre",Ko,"/bind "+t(g.value),1),e("button",{class:"copy-command-btn",onClick:ge},[f(u(ce),{size:16})])])])])])]),e("div",Wo,[e("button",{class:"btn-submit",onClick:K},t(s.$t("profile.iKnow")),1)])])])):p("",!0)]),_:1})],64))}}),at=Se(Xo,[["__scopeId","data-v-d8e5f5ee"]]);export{at as default};
