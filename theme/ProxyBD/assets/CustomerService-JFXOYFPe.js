import{_ as O,c as b,o as C,d as l,e as U,r as F,t as k,a as V,b as G,p as J,f as p,g as P,ax as T,w as W,h as K,ay as o,s as Q,q as X,aj as Y,al as $,aq as ee,ar as E,j as ae,a4 as te}from"./appInit-CGHXFw0-.js";import{I as re}from"./IconArrowLeft-6FkQlYes.js";import{I as se}from"./IconRefresh-DEF_LKdU.js";import"./index-sC8Xq0xY.js";typeof window<"u"&&(window.CRISP_INITIALIZED=window.CRISP_INITIALIZED||!1);const oe={name:"CustomerService",components:{IconArrowLeft:re,IconRefresh:se},setup(){const R=ae(),n=X(),{t:L}=J(),e=p(null),u=p(!0),w=p(null),v=p(window.CRISP_INITIALIZED||!1),y=p("à§³"),a=p(null),c=P(()=>T?.type||"crisp"),A=()=>{if(c.value==="crisp"){if(window.CRISP_INITIALIZED)try{o.chat.show(),o.chat.open(),u.value=!1,v.value=!0;return}catch(t){console.error("Failed to show initialized Crisp:",t)}try{const t=T?.customHtml?.match(/CRISP_WEBSITE_ID="([^"]*)"/),i=t?t[1]:"";if(!i){console.error("Unable to extract Crisp ID from configuration"),u.value=!1;return}if(o.configure(i),(localStorage.getItem("theme")||n.getters.currentTheme||"light")==="dark"&&o.setColorTheme("dark"),n.getters.isLoggedIn){let s="";if(e.value&&typeof e.value=="object"&&(e.value.email?s=e.value.email:e.value.data&&e.value.data.email&&(s=e.value.data.email)),!s&&a.value&&typeof a.value=="object"&&(a.value.email?s=a.value.email:a.value.data&&a.value.data.email&&(s=a.value.data.email)),!s){const S=localStorage.getItem("user");if(S)try{const g=JSON.parse(S);g&&g.email&&(s=g.email)}catch(g){console.error("Failed to parse localStorage user data:",g)}}if(s){o.user.setEmail(s);const S=s.split("@")[0];o.user.setNickname(S)}else console.warn("Unable to get user email, skipping email and nickname setup");let m="Unknown plan";a.value&&a.value.plan&&a.value.plan.name?m=a.value.plan.name:a.value&&a.value.data&&a.value.data.plan&&a.value.data.plan.name?m=a.value.data.plan.name:e.value&&e.value.plan_name&&e.value.plan_name.trim()!==""?m=e.value.plan_name:e.value&&e.value.group&&e.value.group.name&&e.value.group.name.trim()!==""&&(m=e.value.group.name);let h="Unlimited";a.value&&a.value.expired_at?h=E(a.value.expired_at):a.value&&a.value.data&&a.value.data.expired_at?h=E(a.value.data.expired_at):e.value&&e.value.expired_at?h=E(e.value.expired_at):e.value&&e.value.data&&e.value.data.expired_at&&(h=E(e.value.data.expired_at));let f=0,I=0,_=0;a.value&&typeof a.value=="object"&&(a.value.transfer_enable!==void 0?(f=a.value.transfer_enable||0,I=a.value.u||0,_=a.value.d||0):a.value.data&&a.value.data.transfer_enable!==void 0&&(f=a.value.data.transfer_enable||0,I=a.value.data.u||0,_=a.value.data.d||0)),f===0&&e.value&&typeof e.value=="object"&&(e.value.transfer_enable!==void 0?(f=e.value.transfer_enable||0,I=e.value.u||0,_=e.value.d||0):e.value.data&&e.value.data.transfer_enable!==void 0&&(f=e.value.data.transfer_enable||0,I=e.value.data.u||0,_=e.value.data.d||0));const H=((f-(I+_))/(1024*1024*1024)).toFixed(2);let N=0;e.value&&typeof e.value=="object"&&(e.value.balance!==void 0?N=e.value.balance||0:e.value.data&&e.value.data.balance!==void 0&&(N=e.value.data.balance||0));const M={Email:s,Plan:m,Expires:h,Traffic:H+" GB",Balance:N+" "+y.value};o.session.setData(M)}o.session.onLoaded(()=>{u.value=!1,window.CRISP_INITIALIZED=!0,v.value=!0})}catch(t){console.error("Failed to initialize Crisp customer service:",t),u.value=!1}}},D=()=>{document.querySelectorAll('script[id^="zoho"], script[id*="chat"], script[id*="support"], script[id*="customer"]').forEach(r=>{r&&r.parentNode&&r.parentNode.removeChild(r)}),w.value&&(w.value.innerHTML=""),window.ZohoDeskAsap&&(window.ZohoDeskAsap=void 0),document.querySelectorAll('[id*="chat"], [id*="support"], [id*="crisp"], [id*="zoho"], [id*="custom-chat"]').forEach(r=>{r&&r.id!=="other-service-wrapper"&&r.parentNode&&r.parentNode.removeChild(r)})},z=()=>{if(!T?.customHtml||(D(),!document.getElementById("other-service-wrapper")))return;const i=document.createElement("div");i.className="custom-chat-container",document.body.appendChild(i);try{const r=T.customHtml,d=document.createElement("script"),x=document.createElement("div");x.innerHTML=r;const s=x.querySelector("script");s?(Array.from(s.attributes).forEach(m=>{d.setAttribute(m.name,m.value)}),d.textContent=s.textContent||"",document.body.appendChild(d)):(d.textContent=r,document.body.appendChild(d)),u.value=!1}catch(r){console.error("Failed to load customer service script:",r),u.value=!1}},B=P(()=>localStorage.getItem("theme")==="dark"),Z=()=>{c.value==="crisp"?(u.value=!0,o.session.reset(),window.CRISP_INITIALIZED=!1,v.value=!1,te(()=>{A()})):window.location.reload()};W(()=>B.value,t=>{c.value==="crisp"&&v.value&&o.setColorTheme(t?"dark":"light")});const j=async()=>{if(!(!n.getters.isLoggedIn||c.value!=="crisp"))try{const[t,i,r]=await Promise.all([Y(),$(),ee()]);e.value=t.data?t.data:t;const d=i.data?i.data:i;d&&d.currency_symbol&&(y.value=d.currency_symbol),a.value=r.data?r.data:r}catch(t){console.error("Failed to fetch user info:",t)}},q=()=>{if(c.value==="crisp"&&v.value)try{o.chat.hide()}catch(t){console.error("Failed to hide Crisp:",t)}else D();R.back()};return K(async()=>{if(await j(),c.value==="other"){if(!sessionStorage.getItem("cs_page_reloaded")){sessionStorage.setItem("cs_page_reloaded","true"),window.location.reload();return}}else sessionStorage.removeItem("cs_page_reloaded");c.value==="crisp"?A():z(),window.addEventListener("storage",t=>{if(t.key==="theme"&&c.value==="crisp"&&v.value){const i=t.newValue;o.setColorTheme(i==="dark"?"dark":"light")}})}),Q(()=>{if(window.removeEventListener("storage",()=>{}),sessionStorage.removeItem("cs_page_reloaded"),c.value==="crisp"&&v.value)try{o.chat.hide()}catch(t){console.error("Failed to hide Crisp:",t)}else D()}),{isDarkTheme:B,otherServiceContainer:w,refreshChat:Z,goBack:q,serviceType:c,loading:u,t:L}}},ne={class:"service-header"},ie={class:"service-title"},le={class:"service-content"},ce={key:0,class:"service-crisp-container"},de={key:0,class:"service-loading"},ue={key:1,class:"service-other-container"},ve={class:"other-service-tips"},me={id:"other-service-wrapper",ref:"otherServiceContainer"},fe={key:2,class:"service-loading"};function pe(R,n,L,e,u,w){const v=F("IconArrowLeft"),y=F("IconRefresh");return C(),b("div",{class:G(["customer-service-container",{"dark-theme":e.isDarkTheme}])},[l("div",ne,[l("button",{class:"back-button",onClick:n[0]||(n[0]=(...a)=>e.goBack&&e.goBack(...a))},[U(v,{size:24})]),l("h1",ie,k(e.t("service.title")),1),l("button",{class:"refresh-button",onClick:n[1]||(n[1]=(...a)=>e.refreshChat&&e.refreshChat(...a))},[U(y,{size:20})])]),l("div",le,[e.serviceType==="crisp"?(C(),b("div",ce,[e.loading?(C(),b("div",de,[n[2]||(n[2]=l("div",{class:"loading-spinner"},null,-1)),l("p",null,k(e.t("service.loading")),1)])):V("",!0)])):e.serviceType==="other"?(C(),b("div",ue,[l("div",ve,k(e.t("service.waitForIcon")),1),l("div",me,null,512)])):(C(),b("div",fe,[n[3]||(n[3]=l("div",{class:"loading-spinner"},null,-1)),l("p",null,k(e.t("service.loading")),1)]))])],2)}const Ce=O(oe,[["render",pe],["__scopeId","data-v-772bc841"]]);export{Ce as default};
