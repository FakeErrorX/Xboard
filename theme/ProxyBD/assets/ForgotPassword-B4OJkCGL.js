import{_ as ue,I as he,L as fe,k as me,c as m,o as d,d as t,a as v,e as _,n as we,b as O,t as c,r as p,v as Y,l as L,x as K,y as Z,z as D,A as $,B as pe,p as ge,f as w,C as A,E as P,g as M,U as F,F as x,h as ye,G as Ce,H as ve,j as _e,J as Pe,i as ke,S as be,K as Ie,M as Se,N as Te,O as Le}from"./appInit-CGHXFw0-.js";import{A as Me,I as Ee,a as Re,b as Ve,c as De,i as Q,s as Ae}from"./authPopupState-BwxecuRU.js";import{I as Fe,a as Ne}from"./IconSend-ChvXYojB.js";import"./index-sC8Xq0xY.js";import"./IconMail-DCQdTgWz.js";import"./IconArrowRight-CAdyv1A0.js";import"./IconEye-CnVKG0J1.js";import"./IconX-CVTrmr_B.js";import"./IconSend-BZHPAH8O.js";window.onCaptchaForgotPasswordVerified=function(a){window._forgotPasswordInstance&&window._forgotPasswordInstance.handleCaptchaResponse(a)};window.onCaptchaForgotPasswordModalVerified=function(a){window._forgotPasswordInstance&&window._forgotPasswordInstance.handleCaptchaModalResponse(a)};let k=!1;const He=()=>{const a=new Date().getHours();return a>=5&&a<12?"Good Morning":a>=12&&a<18?"Good Afternoon":a>=18&&a<22?"Good Evening":"Good Night"},qe={name:"ForgotPasswordView",components:{ThemeToggle:me,LanguageSelector:fe,IconMail:De,IconCode:Ne,IconLock:he,IconArrowRight:Ve,IconSend:Fe,IconEye:Re,IconEyeOff:Ee,AuthPopup:Me},setup(){const{t:a}=ge(),s=_e(),{showToast:C}=Ce(),e=w(!1),N=w(!0),E=w(!1),b=w(0),W=w(!1),R=w(!1),I=w(""),V=w(!1),S=w(!1),H=A({title:P.popup?.title||"",content:P.popup?.content||"",cooldownHours:P.popup?.cooldownHours||24,closeWaitSeconds:P.popup?.closeWaitSeconds||0}),q=()=>{S.value=!1},B=w("./images/logo.png"),j=()=>{B.value="/images/logo.png"},z=M(()=>{const o=F?.splitLayout?.leftContent?.backgroundImage||"";return o?{"background-image":`url(${o})`,"background-position":"center","background-size":"cover","background-repeat":"no-repeat"}:{background:"var(--theme-color)"}}),i=M(()=>F?.splitLayout?.leftContent?.siteName?.show!==!1),ee=M(()=>(F?.splitLayout?.leftContent?.siteName?.color||"white").toLowerCase()==="black"?"black":"white"),oe=M(()=>F?.splitLayout?.leftContent?.greeting?.show!==!1),te=M(()=>He()),ae=M(()=>(F?.splitLayout?.leftContent?.greeting?.color||"white").toLowerCase()==="black"?"black":"white"),g=A({is_email_verify:1,is_recaptcha:0,recaptcha_site_key:""}),l=A({type:x.captchaType,siteKey:"",verifyUrl:x[x.captchaType]?.verifyUrl||""}),h=A({email:"",verificationCode:"",newPassword:"",confirmPassword:""}),f=A({email:"",verificationCode:"",newPassword:"",confirmPassword:""}),se=w(!1),T=w(""),X=Le();X&&X.proxy&&(window._forgotPasswordInstance={handleCaptchaResponse:o=>{T.value=o},handleCaptchaModalResponse:o=>{o&&typeof o=="string"&&o.trim().length>0&&(I.value=o,setTimeout(()=>{J(),U(o)},300))}});const ne=async()=>{try{N.value=!0;const o=await Ie();o&&o.data&&(Object.assign(g,o.data),g.is_recaptcha===1&&(l.type==="google"?l.siteKey=o.data.recaptcha_site_key:l.type==="cloudflare"&&(l.siteKey=x.cloudflare.siteKey),await G()),E.value=!0,S.value=Ae(P.popup))}catch(o){console.error("Failed to get website configuration:",o),C(a("errors.configLoadFailed"),"error")}finally{N.value=!1}},G=()=>new Promise(o=>{if(g.is_recaptcha!==1||!g.recaptcha_site_key){o();return}if(l.type==="google"&&window.grecaptcha){k=!1,o();return}if(window.turnstile&&l.type==="cloudflare"){console.log("Turnstile exists, trying reset instead of reloading script");try{window.turnstile.reset&&window.turnstile.reset();const n=document.getElementById("modal-turnstile");if(n){n.innerHTML="",setTimeout(()=>{window.turnstile.render("#modal-turnstile",{sitekey:l.siteKey,callback:function(u){window._forgotPasswordInstance&&window._forgotPasswordInstance.handleCaptchaModalResponse(u)},theme:document.body.classList.contains("dark-theme")?"dark":"light",retry:"auto","retry-interval":5e3,"refresh-expired":"manual",tabindex:0,execution:"render"}),o()},100);return}}catch(n){console.error("Failed to reset Turnstile, will try to reload script",n)}}if((()=>{const n=document.getElementById("modal-recaptcha");n&&(n.innerHTML="");const u=document.getElementById("modal-turnstile");u&&(u.innerHTML=""),k=!1})(),!window.turnstile||l.type!=="cloudflare"){const n=document.createElement("script");if(l.type==="google"){const u="https://www.recaptcha.net";n.src=`${u}/recaptcha/api.js?onload=captchaScriptLoaded&render=explicit`}else l.type==="cloudflare"&&(n.src="https://challenges.cloudflare.com/turnstile/v0/api.js?onload=captchaScriptLoaded&render=explicit");n.async=!0,n.defer=!0,window.captchaScriptLoaded=()=>{console.log("Captcha script loaded"),setTimeout(()=>{o()},100)},document.head.appendChild(n)}else o()}),re=()=>{R.value=!0,I.value="",(async()=>{g.is_recaptcha===1&&l.siteKey&&(await G(),setTimeout(()=>{if(l.type==="google"&&window.grecaptcha){const r=document.getElementById("modal-recaptcha");if(r&&!k){r.innerHTML="";try{window.grecaptcha.render("modal-recaptcha",{sitekey:l.siteKey,callback:"onCaptchaForgotPasswordModalVerified",theme:document.body.classList.contains("dark-theme")?"dark":"light"}),k=!0}catch(n){console.error("Google reCAPTCHA render error:",n),n.toString().includes("has already been rendered")?k=!0:k=!1}}}else if(l.type==="cloudflare"&&window.turnstile){const r=document.getElementById("modal-turnstile");if(r){if(r.innerHTML="",window.turnstile.reset)try{window.turnstile.reset()}catch{console.log("Unable to reset Turnstile captcha, re-rendering")}try{window.turnstile.render("#modal-turnstile",{sitekey:l.siteKey,callback:function(n){window._forgotPasswordInstance&&window._forgotPasswordInstance.handleCaptchaModalResponse(n)},theme:document.body.classList.contains("dark-theme")?"dark":"light",retry:"auto","retry-interval":5e3,"refresh-expired":"manual",tabindex:0,execution:"render"})}catch(n){console.error("Turnstile render error:",n);const u=document.getElementsByTagName("script");for(let y=u.length-1;y>=0;y--)u[y].src.includes("turnstile")&&u[y].parentNode.removeChild(u[y]);setTimeout(()=>{const y=document.createElement("script");y.src="https://challenges.cloudflare.com/turnstile/v0/api.js?onload=captchaScriptLoaded&render=explicit",y.async=!0,y.defer=!0,document.head.appendChild(y)},500)}}else console.error("modal-turnstile container not found")}else console.error("Captcha script not loaded or misconfigured",{type:l.type,hasGoogle:!!window.grecaptcha,hasTurnstile:!!window.turnstile})},300))})()},J=()=>{V.value=!0,setTimeout(()=>{R.value=!1,V.value=!1,setTimeout(()=>{const o=document.getElementById("modal-recaptcha");o&&(o.innerHTML=""),k=!1},300)},300)},ie=o=>{o&&typeof o=="string"&&o.trim().length>0&&(I.value=o,setTimeout(()=>{J(),U(o)},300))},U=async o=>{try{e.value=!0;const r={email:h.email,isForgetPassword:!0};o&&(r.recaptcha_data=o);const n=await Te(r);if(n&&n.data===!0){if(ce(),C(n.message||a("auth.codeSent"),"success"),P.verificationCode&&P.verificationCode.showCheckSpamTip){const u=P.verificationCode.checkSpamTipDelay||1e3;setTimeout(()=>{C(a("auth.checkSpam"),"info")},u)}}else throw new Error(n.message||a("auth.sendCodeFailed"))}catch(r){C(r.response?.message||r.message||a("auth.sendCodeFailed"),"error")}finally{e.value=!1}},le=async()=>{if(f.email="",!h.email){f.email=a("auth.emailRequired");return}if(!Q(h.email)){f.email=a("auth.emailInvalid");return}if(g.is_recaptcha===1&&l.siteKey){const o=document.querySelector(".cloudflare-success-message")||document.querySelector(".recaptcha-success");if(!!T.value||o&&o.style.display!=="none"){const n=T.value||document.querySelector('[name="g-recaptcha-response"]')?.value||document.querySelector('[name="cf-turnstile-response"]')?.value;U(n)}else re()}else U()},ce=()=>{b.value=60;const o=setInterval(()=>{b.value--,b.value<=0&&clearInterval(o)},1e3)},de=async()=>{f.email="",f.verificationCode="",f.newPassword="",f.confirmPassword="";let o=!0;if(h.email?Q(h.email)||(f.email=a("auth.emailInvalid"),o=!1):(f.email=a("auth.emailRequired"),o=!1),h.verificationCode||(f.verificationCode=a("auth.codeRequired"),o=!1),h.newPassword?h.newPassword.length<8&&(f.newPassword=a("auth.passwordTooShort"),o=!1):(f.newPassword=a("auth.passwordRequired"),o=!1),h.confirmPassword?h.newPassword!==h.confirmPassword&&(f.confirmPassword=a("auth.passwordsDoNotMatch"),o=!1):(f.confirmPassword=a("auth.confirmPasswordRequired"),o=!1),!!o)try{e.value=!0;const r={email:h.email,password:h.newPassword,email_code:parseInt(h.verificationCode)};if(g.is_recaptcha===1)if(T.value)r.recaptcha_data=T.value;else{const u=document.querySelector('[name="g-recaptcha-response"]')||document.querySelector('[name="cf-turnstile-response"]');u&&u.value&&(r.recaptcha_data=u.value)}const n=await Se(r);if(n.data===!0)C(n.message||a("auth.passwordResetSuccess"),"success"),s.push("/login");else throw new Error(n.message||a("auth.passwordResetFailed"))}catch(r){C(r.response?.message||r.message||a("auth.passwordResetFailed"),"error")}finally{e.value=!1}};return ye(()=>{if(ne(),window.addEventListener("focus",()=>{E.value&&g.is_recaptcha===1&&G()}),new URLSearchParams(window.location.search).get("logout")==="true"){if(C(a("auth.logoutSuccess"),"success"),window.history&&window.history.replaceState){const n=window.location.href.replace("?logout=true","").replace("&logout=true","");window.history.replaceState({},document.title,n)}return}try{if(window._isLoggingOut===!0)return;ve()&&(C(a("auth.alreadyLoggedIn"),"info"),setTimeout(()=>{s.push("/dashboard")},500))}catch{}}),Pe(()=>{E.value&&g.is_recaptcha===1&&l.type==="cloudflare"&&(console.log("Component activated, reloading Cloudflare Turnstile"),G().then(()=>{if(window.turnstile&&window.turnstile.reset)try{window.turnstile.reset()}catch{console.log("Turnstile reset failed, re-rendering captcha component");const r=document.getElementById("modal-turnstile");r&&window.turnstile.render&&(r.innerHTML="",window.turnstile.render("#modal-turnstile",{sitekey:l.siteKey,callback:function(n){window._forgotPasswordInstance&&window._forgotPasswordInstance.handleCaptchaModalResponse(n)},theme:document.body.classList.contains("dark-theme")?"dark":"light","retry-interval":3e3}))}}))}),ke(()=>{if(k=!1,window.turnstile&&window.turnstile.reset)try{window.turnstile.reset()}catch(r){console.log("Turnstile reset failed",r)}const o=document.getElementById("modal-turnstile");o&&(o.innerHTML=""),T.value="",I.value="",window.captchaScriptLoaded=void 0,window.onCaptchaForgotPasswordVerified=void 0,window.onCaptchaForgotPasswordModalVerified=void 0,window._forgotPasswordInstance=null}),{formData:h,errors:f,loading:e,cooldown:b,sendVerificationCode:le,handleSubmit:de,isValidEmail:Q,showPassword:W,showConfirmPassword:se,logoPath:B,handleLogoError:j,config:g,captchaConfig:l,showCaptchaModal:R,closeCaptchaModal:J,handleCaptchaModalResponse:ie,isClosingModal:V,leftSideStyles:z,configLoading:N,configLoaded:E,showSiteName:i,siteNameColorClass:ee,SITE_CONFIG:be,showGreeting:oe,greetingMessage:te,greetingColorClass:ae,showAuthPopup:S,authPopupConfig:H,handleAuthPopupClose:q}}},Be={class:"forgot-password-view-container"},Ge={class:"auth-split-container"},Ue={class:"auth-split-right"},Oe={class:"top-toolbar"},Ke={key:0,class:"auth-form-container"},xe={class:"loading-container"},We={key:1,class:"auth-form-container"},je={class:"auth-header"},ze={class:"auth-logo"},Je=["src"],Ye={class:"auth-title"},Qe={class:"auth-subtitle"},Xe={class:"form-group"},Ze={for:"email"},$e={class:"input-with-icon"},eo=["placeholder"],oo={key:0,class:"error-message"},to={class:"form-group"},ao={for:"verificationCode"},so={class:"input-with-button"},no={class:"input-with-icon verification-input"},ro=["placeholder"],io=["disabled"],lo={key:0,class:"error-message"},co={class:"form-group"},uo={for:"newPassword"},ho={class:"input-with-icon"},fo=["type","placeholder"],mo={key:0,class:"error-message"},wo={class:"form-group"},po={for:"confirmPassword"},go={class:"input-with-icon"},yo=["type","placeholder"],Co={key:0,class:"error-message"},vo=["disabled"],_o={key:0,class:"loading-wrapper"},Po={key:1},ko={class:"auth-footer"},bo={class:"auth-divider"},Io={class:"auth-divider-text"},So={class:"captcha-modal-header"},To={class:"captcha-modal-body"};function Lo(a,s,C,e,N,E){const b=p("ThemeToggle"),W=p("LanguageSelector"),R=p("IconMail"),I=p("IconCode"),V=p("IconSend"),S=p("IconLock"),H=p("IconEye"),q=p("IconEyeOff"),B=p("IconArrowRight"),j=p("router-link"),z=p("AuthPopup");return d(),m("div",Be,[t("div",Ge,[t("div",{class:"auth-split-left",style:we(e.leftSideStyles)},[s[13]||(s[13]=t("div",{class:"left-content-overlay"},null,-1)),e.showSiteName?(d(),m("div",{key:0,class:O(["site-name",e.siteNameColorClass])},c(e.SITE_CONFIG.siteName),3)):v("",!0),e.showGreeting?(d(),m("div",{key:1,class:O(["greeting-text",e.greetingColorClass])},c(e.greetingMessage),3)):v("",!0)],4),t("div",Ue,[t("div",Oe,[_(b),_(W)]),e.configLoading?(d(),m("div",Ke,[t("div",xe,[s[14]||(s[14]=t("div",{class:"loading-spinner"},null,-1)),t("p",null,c(a.$t("common.loading")),1)])])):(d(),m("div",We,[t("div",je,[t("div",ze,[t("img",{src:e.logoPath,alt:"Logo",onError:s[0]||(s[0]=(...i)=>e.handleLogoError&&e.handleLogoError(...i))},null,40,Je)]),t("h1",Ye,c(a.$t("auth.forgotPasswordTitle")),1),t("p",Qe,c(a.$t("auth.forgotPasswordSubtitle")),1)]),t("form",{class:"auth-form",onSubmit:s[8]||(s[8]=Y((...i)=>e.handleSubmit&&e.handleSubmit(...i),["prevent"]))},[t("div",Xe,[t("label",Ze,[L(c(a.$t("common.email"))+" ",1),s[15]||(s[15]=t("span",{class:"required"},"*",-1))]),t("div",$e,[_(R,{class:"input-icon"}),K(t("input",{type:"email",id:"email",class:"form-control","onUpdate:modelValue":s[1]||(s[1]=i=>e.formData.email=i),placeholder:a.$t("auth.emailPlaceholder")},null,8,eo),[[Z,e.formData.email]])]),e.errors.email?(d(),m("div",oo,c(e.errors.email),1)):v("",!0)]),t("div",to,[t("label",ao,[L(c(a.$t("common.verificationCode"))+" ",1),s[16]||(s[16]=t("span",{class:"required"},"*",-1))]),t("div",so,[t("div",no,[_(I,{class:"input-icon"}),K(t("input",{type:"text",id:"verificationCode",class:"form-control","onUpdate:modelValue":s[2]||(s[2]=i=>e.formData.verificationCode=i),placeholder:a.$t("auth.codePlaceholder")},null,8,ro),[[Z,e.formData.verificationCode]])]),t("button",{class:"send-code-btn",onClick:s[3]||(s[3]=(...i)=>e.sendVerificationCode&&e.sendVerificationCode(...i)),disabled:!e.isValidEmail(e.formData.email)||e.cooldown>0||e.loading,type:"button"},[e.cooldown===0?(d(),D(V,{key:0,class:"icon-left"})):v("",!0),t("span",null,c(e.cooldown>0?`${e.cooldown}s`:a.$t("common.sendCode")),1)],8,io)]),e.errors.verificationCode?(d(),m("div",lo,c(e.errors.verificationCode),1)):v("",!0)]),t("div",co,[t("label",uo,[L(c(a.$t("auth.newPassword"))+" ",1),s[17]||(s[17]=t("span",{class:"required"},"*",-1))]),t("div",ho,[_(S,{class:"input-icon"}),K(t("input",{type:e.showPassword?"text":"password",id:"newPassword",class:"form-control","onUpdate:modelValue":s[4]||(s[4]=i=>e.formData.newPassword=i),placeholder:a.$t("auth.newPasswordPlaceholder")},null,8,fo),[[$,e.formData.newPassword]]),t("div",{class:"password-toggle",onClick:s[5]||(s[5]=i=>e.showPassword=!e.showPassword)},[e.showPassword?(d(),D(q,{key:1})):(d(),D(H,{key:0}))])]),e.errors.newPassword?(d(),m("div",mo,c(e.errors.newPassword),1)):v("",!0)]),t("div",wo,[t("label",po,[L(c(a.$t("common.confirmPassword"))+" ",1),s[18]||(s[18]=t("span",{class:"required"},"*",-1))]),t("div",go,[_(S,{class:"input-icon"}),K(t("input",{type:e.showConfirmPassword?"text":"password",id:"confirmPassword",class:"form-control","onUpdate:modelValue":s[6]||(s[6]=i=>e.formData.confirmPassword=i),placeholder:a.$t("auth.confirmPasswordPlaceholder")},null,8,yo),[[$,e.formData.confirmPassword]]),t("div",{class:"password-toggle",onClick:s[7]||(s[7]=i=>e.showConfirmPassword=!e.showConfirmPassword)},[e.showConfirmPassword?(d(),D(q,{key:1})):(d(),D(H,{key:0}))])]),e.errors.confirmPassword?(d(),m("div",Co,c(e.errors.confirmPassword),1)):v("",!0)]),t("button",{class:"btn btn-primary btn-block",disabled:e.loading||!e.formData.email||!e.formData.verificationCode||!e.formData.newPassword||!e.formData.confirmPassword,type:"submit"},[e.loading?(d(),m("span",_o,[t("span",null,c(a.$t("common.loading")),1)])):(d(),m("span",Po,[L(c(a.$t("common.resetPassword"))+" ",1),_(B,{class:"icon-right"})]))],8,vo)],32),t("div",ko,[t("div",bo,[t("span",Io,c(a.$t("auth.rememberPassword")),1)]),_(j,{to:"/login",class:"btn btn-secondary btn-block",replace:""},{default:pe(()=>[L(c(a.$t("common.login")),1)]),_:1})])]))])]),e.showCaptchaModal?(d(),m("div",{key:0,class:O(["captcha-modal",{closing:e.isClosingModal}])},[t("div",{class:"captcha-modal-overlay",onClick:s[9]||(s[9]=(...i)=>e.closeCaptchaModal&&e.closeCaptchaModal(...i))}),t("div",{class:O(["captcha-modal-content",{closing:e.isClosingModal}])},[t("div",So,[t("h3",null,c(a.$t("auth.captcha")),1),t("button",{class:"close-btn",onClick:s[10]||(s[10]=(...i)=>e.closeCaptchaModal&&e.closeCaptchaModal(...i))},[...s[19]||(s[19]=[t("span",null,"Ã—",-1)])])]),t("div",To,[t("p",null,c(a.$t("auth.captchaRequired")),1),e.captchaConfig.type==="google"?(d(),m("div",{key:0,class:"google-captcha",onClick:s[11]||(s[11]=Y(()=>{},["stop"]))},[...s[20]||(s[20]=[t("div",{id:"modal-recaptcha"},null,-1)])])):e.captchaConfig.type==="cloudflare"?(d(),m("div",{key:1,class:"cloudflare-captcha",onClick:s[12]||(s[12]=Y(()=>{},["stop"]))},[...s[21]||(s[21]=[t("div",{id:"modal-turnstile"},null,-1)])])):v("",!0)])],2)],2)):v("",!0),_(z,{"show-popup":e.showAuthPopup,title:e.authPopupConfig.title,content:e.authPopupConfig.content,"cooldown-hours":e.authPopupConfig.cooldownHours,"close-wait-seconds":e.authPopupConfig.closeWaitSeconds,onClose:e.handleAuthPopupClose},null,8,["show-popup","title","content","cooldown-hours","close-wait-seconds","onClose"])])}const qo=ue(qe,[["render",Lo],["__scopeId","data-v-901c7350"]]);export{qo as default};
