import{Z as ee,_ as oe,a6 as se,c as l,o as i,d as o,a as w,t,e as B,r as h,a0 as D,a9 as O,b as T,x as ae,y as re,z as x,a8 as ne,l as te,p as ie,C as le,f as y,g,h as ce,an as de,G as ue,j as pe,aA as ve}from"./appInit-CGHXFw0-.js";import{a as _e,g as me,s as ye,v as fe}from"./shop-Cvi7wzfy.js";import{a as he}from"./dashboard-C9PMFZKp.js";import{I as ge}from"./IconAlertTriangle-BKoak6h-.js";import{I as be}from"./IconArrowLeft-6FkQlYes.js";import{I as ke}from"./IconBox-DpyC7iFF.js";import{I as Ce}from"./IconCheck-B408Qq3X.js";import{I as Ie}from"./IconX-CVTrmr_B.js";import"./index-sC8Xq0xY.js";/**
 * @license @tabler/icons-vue v3.35.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var we=ee("outline","rosette-discount","RosetteDiscount",[["path",{d:"M9 15l6 -6",key:"svg-0"}],["circle",{cx:"9.5",cy:"9.5",r:".5",fill:"currentColor",key:"svg-1"}],["circle",{cx:"14.5",cy:"14.5",r:".5",fill:"currentColor",key:"svg-2"}],["path",{d:"M5 7.2a2.2 2.2 0 0 1 2.2 -2.2h1a2.2 2.2 0 0 0 1.55 -.64l.7 -.7a2.2 2.2 0 0 1 3.12 0l.7 .7a2.2 2.2 0 0 0 1.55 .64h1a2.2 2.2 0 0 1 2.2 2.2v1a2.2 2.2 0 0 0 .64 1.55l.7 .7a2.2 2.2 0 0 1 0 3.12l-.7 .7a2.2 2.2 0 0 0 -.64 1.55v1a2.2 2.2 0 0 1 -2.2 2.2h-1a2.2 2.2 0 0 0 -1.55 .64l-.7 .7a2.2 2.2 0 0 1 -3.12 0l-.7 -.7a2.2 2.2 0 0 0 -1.55 -.64h-1a2.2 2.2 0 0 1 -2.2 -2.2v-1a2.2 2.2 0 0 0 -.64 -1.55l-.7 -.7a2.2 2.2 0 0 1 0 -3.12l.7 -.7a2.2 2.2 0 0 0 .64 -1.55v-1",key:"svg-3"}]]);const Pe={name:"OrderConfirm",components:{IconCheck:Ce,IconX:Ie,IconBox:ke,IconShoppingCart:se,IconDiscount2:we,IconArrowLeft:be,IconAlertTriangle:ge},setup(){const{t:a}=ie(),{showToast:r}=ue(),b=de(),s=pe(),p=le({plan:!0,userInfo:!0,submitting:!1}),u=y(null),m=y(null),S=y("BDT"),P=y("৳"),v=y(""),_=y(""),f=y(!1),k=y(!1),n=y(null),d=y(0),C=g(()=>!u.value||!v.value?0:u.value[v.value]||0),A=g(()=>!f.value||!n.value?0:n.value.type===1?n.value.value:n.value.type===2&&d.value>0&&C.value>0?Math.round(C.value*(d.value/100)):0),z=g(()=>Math.max(0,C.value-A.value)),M=g(()=>m.value?m.value.plan_id&&m.value.expired_at&&m.value.expired_at*1e3>Date.now():!1),F=g(()=>{if(!u.value)return{};const e={};return["month_price","quarter_price","half_year_price","year_price","two_year_price","three_year_price","onetime_price"].forEach(I=>{u.value[I]!==null&&(e[I]=u.value[I])}),e}),J=g(()=>{if(!u.value)return"";const e={month_price:1,quarter_price:3,half_year_price:6,year_price:12,two_year_price:24,three_year_price:36,onetime_price:12};let c="",I=0;return Object.entries(F.value).forEach(([V,q])=>{if(q<=0)return;const N=e[V]/q;N>I&&(I=N,c=V)}),c}),L=e=>e.capacity_limit===0?a("shop.plan.stock.sold_out"):e.capacity_limit>0&&e.capacity_limit<5?a("shop.plan.stock.warning"):a("shop.plan.stock.plenty"),E=e=>e.capacity_limit===0?"stock-danger":e.capacity_limit>0&&e.capacity_limit<5?"stock-warning":"stock-plenty",j=e=>({month_price:"month",quarter_price:"quarter",half_year_price:"half_year",year_price:"year",two_year_price:"two_year",three_year_price:"three_year",onetime_price:"onetime"})[e]||"",R=e=>{if(!e)return!1;try{const c=JSON.parse(e);return Array.isArray(c)&&c.length>0&&Object.prototype.hasOwnProperty.call(c[0],"feature")}catch{return!1}},X=e=>{try{return JSON.parse(e)}catch{return[]}},H=e=>{v.value=e},U=async()=>{if(!(!_.value||k.value)){k.value=!0;try{const e=await fe(_.value,u.value.id);if(e.data)if(f.value=!0,n.value=e.data,e.message&&r(e.message,"success"),e.data.type===1)A.value=e.data.value,d.value=0,e.message||r(a("order.coupon_success_fixed",{code:_.value,amount:(e.data.value/100).toFixed(2)}),"success");else if(e.data.type===2){if(d.value=n.value.value,ve()){const c=Math.round(C.value*(d.value/100));n.value.calculatedDiscountAmount=c}e.message||r(a("order.coupon_success_percent",{code:_.value,percent:n.value.value}),"success")}else e.message||r(a("order.coupon_success",{code:_.value}),"success");else f.value=!1,d.value=0,A.value=0,n.value=null,r(e.message||a("order.coupon_invalid"),"error")}catch(e){console.error("Failed to validate coupon:",e),f.value=!1,d.value=0,A.value=0,n.value=null,r(e.response?.message||e.message||a("order.coupon_invalid"),"error")}finally{k.value=!1}}},W=async()=>{if(!(!v.value||p.submitting)){p.submitting=!0;try{const e={plan_id:Number(u.value.id),period:v.value};f.value&&_.value&&n.value&&(e.coupon_code=_.value);const c=await ye(e);c.data?(r(c.message||a("order.order_success"),"success"),s.push({path:"/payment",query:{trade_no:c.data}})):r(c.message||a("order.order_failed"),"error")}catch(e){console.error("Failed to submit order:",e),r(e.response?.message||e.message||a("order.order_failed"),"error")}finally{p.submitting=!1}}},K=()=>{s.push("/shop")},G=async()=>{p.plan=!0;try{if(!b.query.id){r(a("order.no_plan_selected"),"error"),s.push("/shop");return}const e=await _e(b.query.id);if(e.data)if(u.value=e.data,b.query.period&&u.value[b.query.period]!==null)v.value=b.query.period;else{const c=Object.keys(F.value)[0];v.value=c||""}else r(e.message||a("order.plan_not_found"),"error"),s.push("/shop")}catch(e){console.error("Failed to fetch plan data:",e),r(e.response?.message||e.message||a("order.failed_to_fetch_plan"),"error")}finally{p.plan=!1}},Z=async()=>{p.userInfo=!0;try{const e=await he();e.data?m.value=e.data:e.message&&r(e.message,"warning")}catch(e){console.error("Failed to get user info:",e),r(e.response?.message||e.message||a("dashboard.userinfo_error"),"error")}finally{p.userInfo=!1}},Q=async()=>{try{const e=await me();e.data?(S.value=e.data.currency||"BDT",P.value=e.data.currency_symbol||"৳"):e.message&&r(e.message,"warning")}catch(e){console.error("Failed to fetch system configuration:",e),r(e.response?.message||e.message||a("shop.config_error"),"error")}},Y=()=>{_.value="",f.value=!1,d.value=0,n.value=null,r(a("order.coupon_removed"),"info")},$=g(()=>p.userInfo||p.plan||!u.value||!m.value?!1:M.value&&u.value.id!==m.value.plan_id);return ce(async()=>{await Promise.all([G(),Z(),Q()])}),{plan:u,userInfo:m,loading:p,currency:S,currencySymbol:P,selectedPriceType:v,couponCode:_,couponApplied:f,verifying:k,couponInfo:n,originalPrice:C,discountAmount:A,finalPrice:z,userHasActivePlan:M,availablePrices:F,bestValuePeriod:J,getPriceTypeKey:j,isJsonContent:R,parseJsonContent:X,selectPriceType:H,verifyCoupon:U,submitOrder:W,goBack:K,getPlanStockText:L,getStockBadgeClass:E,removeCoupon:Y,showExistingPlanWarning:$}}},Ae={class:"order-confirm-container"},Te={class:"order-confirm-inner"},xe={class:"dashboard-card welcome-card"},Se={class:"card-header"},Be={class:"card-title"},De={class:"card-body"},Oe={key:0,class:"alert-card"},Fe={class:"alert-icon"},Me={class:"alert-content"},Ve={class:"content-wrapper"},qe={class:"left-column"},Ne={key:0,class:"plan-card glassmorphism"},ze={class:"skeleton-card"},Je={class:"skeleton-body"},Le={class:"skeleton-features"},Ee={key:1,class:"plan-card glassmorphism"},je={class:"card-header"},Re={class:"card-title"},Xe={class:"card-body"},He={class:"plan-features"},Ue=["innerHTML"],We={key:2,class:"section-wrapper"},Ke={class:"section-title"},Ge={class:"period-selection"},Ze={class:"period-cards",style:{display:"grid","grid-template-columns":"repeat(auto-fit, minmax(120px, 1fr))",gap:"15px",width:"100%"}},Qe=["onClick"],Ye={class:"period-card-inner"},$e={class:"period-type"},eo={class:"period-price"},oo={class:"currency"},so={class:"amount"},ao={key:3,class:"section-wrapper"},ro={class:"section-title"},no={class:"period-selection"},to={class:"skeleton-period-cards"},io={class:"right-column"},lo={class:"section-wrapper"},co={class:"section-title"},uo={class:"coupon-input"},po=["disabled","placeholder"],vo=["disabled"],_o={key:2,class:"loader"},mo={class:"section-wrapper order-summary-section"},yo={class:"section-title"},fo={class:"order-summary glassmorphism"},ho={key:0},go={key:1},bo={class:"summary-row"},ko={class:"summary-label"},Co={class:"summary-value"},Io={key:0,class:"summary-row"},wo={class:"summary-label"},Po={key:0,class:"coupon-name"},Ao={class:"summary-value discount"},To={class:"summary-row total"},xo={class:"summary-label"},So={class:"summary-value"},Bo={class:"action-buttons"},Do=["disabled"],Oo=["disabled"],Fo={key:1,class:"loader"};function Mo(a,r,b,s,p,u){const m=h("IconAlertTriangle"),S=h("IconBox"),P=h("IconCheck"),v=h("IconX"),_=h("IconDiscount2"),f=h("IconArrowLeft"),k=h("IconShoppingCart");return i(),l("div",Ae,[o("div",Te,[o("div",xe,[o("div",Se,[o("h2",Be,t(a.$t("order.title")),1)]),o("div",De,[o("p",null,t(a.$t("order.description")),1)])]),s.showExistingPlanWarning?(i(),l("div",Oe,[o("div",Fe,[B(m,{size:22})]),o("div",Me,[o("h4",null,t(a.$t("order.existing_plan_warning_title")),1),o("p",null,t(a.$t("order.existing_plan_warning_desc")),1)])])):w("",!0),o("div",Ve,[o("div",qe,[s.loading.plan?(i(),l("div",Ne,[o("div",ze,[r[6]||(r[6]=o("div",{class:"skeleton-header"},null,-1)),o("div",Je,[r[5]||(r[5]=o("div",{class:"skeleton-title"},null,-1)),o("div",Le,[(i(),l(D,null,O(4,n=>o("div",{class:"skeleton-feature",key:"feature-"+n})),64))])])])])):s.plan?(i(),l("div",Ee,[o("div",je,[o("h3",Re,t(s.plan.name),1),o("div",{class:T(["card-badge",s.getStockBadgeClass(s.plan)])},[B(S,{size:16,class:"badge-icon"}),o("span",null,t(s.getPlanStockText(s.plan)),1)],2)]),o("div",Xe,[o("div",He,[s.isJsonContent(s.plan.content)?(i(!0),l(D,{key:0},O(s.parseJsonContent(s.plan.content),(n,d)=>(i(),l("div",{class:"feature-item",key:d},[n.support?(i(),x(P,{key:0,class:"feature-icon enabled"})):(i(),x(v,{key:1,class:"feature-icon disabled"})),o("span",{class:T({"disabled-text":!n.support})},t(n.feature),3)]))),128)):(i(),l("div",{key:1,class:"html-content",innerHTML:s.plan.content},null,8,Ue))])])])):w("",!0),s.loading.plan?(i(),l("div",ao,[o("div",ro,[o("span",null,t(a.$t("order.select_period")),1)]),o("div",no,[o("div",to,[(i(),l(D,null,O(2,n=>o("div",{class:"skeleton-period-card",key:"skeleton-period-"+n})),64))])])])):(i(),l("div",We,[o("div",Ke,[o("span",null,t(a.$t("order.select_period")),1)]),o("div",Ge,[o("div",Ze,[(i(!0),l(D,null,O(s.availablePrices,(n,d)=>(i(),l("div",{key:d,class:T(["period-card",{active:s.selectedPriceType===d}]),onClick:C=>s.selectPriceType(d)},[o("div",Ye,[o("div",$e,t(a.$t(`shop.plan.price_options.${s.getPriceTypeKey(d)}`)),1),o("div",eo,[o("span",oo,t(s.currencySymbol),1),o("span",so,t((n/100).toFixed(2)),1)])])],10,Qe))),128))])])]))]),o("div",io,[o("div",lo,[o("div",co,[o("span",null,t(a.$t("order.coupon")),1)]),o("div",uo,[ae(o("input",{type:"text","onUpdate:modelValue":r[0]||(r[0]=n=>s.couponCode=n),disabled:s.loading.plan||s.couponApplied,placeholder:a.$t("order.enter_coupon"),class:T(["coupon-field",{applied:s.couponApplied}])},null,10,po),[[re,s.couponCode]]),o("button",{class:T(["btn-verify",{applied:s.couponApplied}]),onClick:r[1]||(r[1]=(...n)=>s.verifyCoupon&&s.verifyCoupon(...n)),disabled:!s.couponCode||s.verifying||s.loading.plan||s.couponApplied},[!s.verifying&&!s.couponApplied?(i(),x(_,{key:0})):s.couponApplied?(i(),x(P,{key:1})):s.verifying?(i(),l("span",_o)):w("",!0),o("span",null,t(s.couponApplied?a.$t("order.coupon_applied"):a.$t("order.verify_coupon")),1)],10,vo),s.couponApplied?(i(),l("button",{key:0,class:"btn-remove-coupon",onClick:r[2]||(r[2]=(...n)=>s.removeCoupon&&s.removeCoupon(...n))},[B(v,{size:16}),o("span",null,t(a.$t("order.remove_coupon")),1)])):w("",!0)])]),o("div",mo,[o("div",yo,[o("span",null,t(a.$t("order.order_summary")),1)]),o("div",fo,[s.loading.plan?(i(),l("div",ho,[...r[7]||(r[7]=[ne('<div class="summary-row skeleton" data-v-c717f91b><div class="summary-label skeleton-text" data-v-c717f91b></div><div class="summary-value skeleton-text" data-v-c717f91b></div></div><div class="summary-divider" data-v-c717f91b></div><div class="summary-row skeleton total" data-v-c717f91b><div class="summary-label skeleton-text" data-v-c717f91b></div><div class="summary-value skeleton-text" data-v-c717f91b></div></div>',3)])])):(i(),l("div",go,[o("div",bo,[o("div",ko,t(a.$t("order.subtotal")),1),o("div",Co,t(s.currencySymbol)+t((s.originalPrice/100).toFixed(2)),1)]),s.discountAmount>0?(i(),l("div",Io,[o("div",wo,[te(t(a.$t("order.discount"))+" ",1),s.couponInfo?(i(),l("span",Po,"("+t(s.couponInfo.name)+")",1)):w("",!0)]),o("div",Ao,"-"+t(s.currencySymbol)+t((s.discountAmount/100).toFixed(2)),1)])):w("",!0),r[8]||(r[8]=o("div",{class:"summary-divider"},null,-1)),o("div",To,[o("div",xo,t(a.$t("order.total")),1),o("div",So,t(s.currencySymbol)+t((s.finalPrice/100).toFixed(2)),1)])]))])]),o("div",Bo,[o("button",{class:"btn-back",onClick:r[3]||(r[3]=(...n)=>s.goBack&&s.goBack(...n)),disabled:s.loading.plan},[B(f,{size:18}),o("span",null,t(a.$t("order.back_to_shop")),1)],8,Do),o("button",{class:"btn-order",onClick:r[4]||(r[4]=(...n)=>s.submitOrder&&s.submitOrder(...n)),disabled:!s.selectedPriceType||s.loading.submitting||s.loading.plan},[s.loading.submitting?(i(),l("span",Fo)):(i(),x(k,{key:0,size:18})),o("span",null,t(a.$t("order.place_order")),1)],8,Oo)])])])])])}const Xo=oe(Pe,[["render",Mo],["__scopeId","data-v-c717f91b"]]);export{Xo as default};
